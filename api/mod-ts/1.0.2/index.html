<!DOCTYPE html><html lang="en"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 34.1.4">
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-width:.2em;border-style:solid;background:#fbe9e9}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
  
  
  
  
<title>API Design Rules Module: Transport Security 1.0.2</title>
  
<link href="./media/style.css" rel="stylesheet" type="text/css">
  
<link rel="shortcut icon" type="image/x-icon" href="https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/logius.ico">
  

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline;position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-.7em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<style id="respec-nlgov">
img.license{float:left;padding-right:5px}
</style>
<meta name="description" content="Dit betreft een technische module is die een aantal eisen invult op het gebied van transport security &amp; http security.">
<style>

  .sidelabel {
    position: fixed;
    -webkit-transform-origin: top right;
    right: 100%;
    top: 0;
    -webkit-transform: rotate(-90deg);
    padding: 4px 50px 4px 10px;
    color: white;
    white-space: nowrap;
    z-index: 1;
    background-color: #154273;
  }
</style>
<script id="initialUserConfig" type="application/json">{
  "nl_organisationName": "Logius",
  "nl_organisationStylesURL": "https://gitdocumentatie.logius.nl/publicatie/respec/style/",
  "nl_organisationPublishURL": "https://gitdocumentatie.logius.nl/publicatie/",
  "logos": [
    {
      "src": "https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/figure-logius.svg",
      "alt": "Logius",
      "id": "Logius",
      "height": 77,
      "width": 44,
      "url": "https://www.logius.nl/standaarden"
    }
  ],
  "latestVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "shortName",
    "/"
  ],
  "thisVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "shortName",
    "/",
    "publishVersion",
    "/"
  ],
  "prevVersion": [
    "nl_organisationPublishURL",
    "pubDomain",
    "/",
    "shortName",
    "/",
    "previousPublishVersion",
    "/"
  ],
  "useLogo": true,
  "useLabel": true,
  "license": "cc-by",
  "addSectionLinks": true,
  "localizationStrings": {
    "en": {
      "wv": "Draft",
      "cv": "Consultation version",
      "vv": "Proposed version",
      "def": "Definitive version",
      "basis": "Document",
      "eo": "Outdated version",
      "tg": "Rescinded version",
      "no": "Norm",
      "st": "Standard",
      "im": "Information model",
      "pr": "Guideline",
      "hr": "Guide",
      "wa": "Proposed recommendation",
      "al": "General",
      "bd": "Governance documentation",
      "bp": "Best practice"
    },
    "nl": {
      "wv": "Werkversie",
      "cv": "Consultatieversie",
      "vv": "Versie ter vaststelling",
      "def": "Vastgestelde versie",
      "basis": "Document",
      "eo": "Verouderde versie",
      "tg": "Teruggetrokken versie",
      "no": "Norm",
      "st": "Standaard",
      "im": "Informatiemodel",
      "pr": "Praktijkrichtlijn",
      "hr": "Handreiking",
      "wa": "Werkafspraak",
      "al": "Algemeen",
      "bd": "Beheerdocumentatie",
      "bp": "Best practice"
    }
  },
  "sotdText": {
    "nl": {
      "sotd": "Status van dit document",
      "def": "Dit is de definitieve versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
      "wv": "Dit is een werkversie die op elk moment kan worden gewijzigd, verwijderd of vervangen door andere documenten. Het is geen door het TO goedgekeurde consultatieversie.",
      "cv": "Dit is een door het TO goedgekeurde consultatieversie. Commentaar over dit document kan gestuurd worden naar digikoppeling@logius.nl",
      "vv": "Dit is een definitief concept van de nieuwe versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
      "basis": "Dit is een document zonder officiële status."
    },
    "en": {
      "sotd": "Status of This Document",
      "def": "This is the definitive version of this document. Edits resulting from consultations have been applied.",
      "wv": "This is a draft that could be altered, removed or replaced by other documents. It is not a recommendation approved by TO.",
      "cv": "This is a proposed recommendation approved by TO. Comments regarding this document may be sent to api@logius.nl",
      "vv": "This is the definitive concept of this document. Edits resulting from consultations have been applied.",
      "basis": "This document has no official standing."
    }
  },
  "labelColor": {
    "def": "#154273",
    "wv": "#39870c",
    "cv": "#000000",
    "vv": "#000000"
  },
  "licenses": {
    "cc0": {
      "name": "Creative Commons 0 Public Domain Dedication",
      "short": "CC0",
      "url": "https://creativecommons.org/publicdomain/zero/1.0/",
      "image": "https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-zero.svg"
    },
    "cc-by": {
      "name": "Creative Commons Attribution 4.0 International Public License",
      "short": "CC-BY",
      "url": "https://creativecommons.org/licenses/by/4.0/legalcode",
      "image": "https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-by.svg"
    },
    "cc-by-nd": {
      "name": "Creative Commons Naamsvermelding-GeenAfgeleideWerken 4.0 Internationaal",
      "short": "CC-BY-ND",
      "url": "https://creativecommons.org/licenses/by-nd/4.0/legalcode.nl",
      "image": "https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-by-nd.svg"
    }
  },
  "localBiblio": {
    "NCSC.TLS": {
      "href": "https://www.ncsc.nl/documenten/publicaties/2021/januari/19/ict-beveiligingsrichtlijnen-voor-transport-layer-security-2.1",
      "title": "ICT-beveiligingsrichtlijnen voor Transport Layer Security (TLS)",
      "authors": [
        "NCSC"
      ],
      "date": "Januari 2021",
      "id": "ncsc.tls"
    }
  },
  "pubDomain": "api",
  "shortName": "mod-ts",
  "specType": "HR",
  "specStatus": "DEF",
  "publishDate": "2024-06-06",
  "publishVersion": "1.0.2",
  "previousPublishVersion": "1.0.1",
  "previousPublishDate": "2024-03-07",
  "editors": [
    {
      "company": "Geonovum",
      "companyURL": "https://www.geonovum.nl",
      "name": "Frank Terpstra"
    },
    {
      "company": "Logius",
      "companyURL": "https://www.logius.nl",
      "name": "Alexander Green"
    },
    {
      "company": "Logius",
      "companyURL": "https://www.logius.nl",
      "name": "Martin van der Plas"
    }
  ],
  "authors": [
    {
      "name": "Kennisplatform API's",
      "company": "Kennisplatform API's",
      "companyURL": "https://github.com/Geonovum/KP-APIs"
    }
  ],
  "github": "https://github.com/Logius-standaarden/API-mod-transport-security"
}</script>
<link rel="stylesheet" href="https://gitdocumentatie.logius.nl/publicatie/respec/style/base.css"></head>

<body class="h-entry toc-inline"><div class="head">
    <a class="logo" href="https://www.logius.nl/standaarden"><img alt="Logius" height="77" id="Logius" src="https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/figure-logius.svg" width="44">
  </a> <h1 id="title" class="title">API Design Rules Module: Transport Security 1.0.2</h1>
    
    <h2>
      Logius Guide<br>
      Definitive version
      <time class="dt-published" datetime="2024-06-06">June 06, 2024</time>
    </h2>
    <dl>
      <dt>This version:</dt><dd class="status">
              <a class="u-url status" href="https://gitdocumentatie.logius.nl/publicatie/api/mod-ts/1.0.2/">https://gitdocumentatie.logius.nl/publicatie/api/mod-ts/1.0.2/</a>
            </dd>
      <dt>Latest published version:</dt><dd>
              <a href="https://gitdocumentatie.logius.nl/publicatie/api/mod-ts/">https://gitdocumentatie.logius.nl/publicatie/api/mod-ts/</a>
            </dd>
      <dt>Latest editor's draft:</dt><dd><a href="https://logius-standaarden.github.io/API-mod-transport-security/">https://logius-standaarden.github.io/API-mod-transport-security/</a></dd>
      
      
      
      <dt>Previous version:</dt><dd><a href="https://gitdocumentatie.logius.nl/publicatie/api/mod-ts/1.0.1/">https://gitdocumentatie.logius.nl/publicatie/api/mod-ts/1.0.1/</a></dd>
      
      <dt>Editors:</dt>
      <dd class="editor p-author h-card vcard">
    <span class="p-name fn">Frank Terpstra</span> (<a class="p-org org h-org" href="https://www.geonovum.nl">Geonovum</a>)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Alexander Green</span> (<a class="p-org org h-org" href="https://www.logius.nl">Logius</a>)
  </dd><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Martin van der Plas</span> (<a class="p-org org h-org" href="https://www.logius.nl">Logius</a>)
  </dd>
      
      <dt>Author:</dt><dd class="editor p-author h-card vcard">
    <span class="p-name fn">Kennisplatform API's</span> (<a class="p-org org h-org" href="https://github.com/Geonovum/KP-APIs">Kennisplatform API's</a>)
  </dd>
      <dt>Participate:</dt><dd>
    <a href="https://github.com/Logius-standaarden/API-mod-transport-security/">GitHub Logius-standaarden/API-mod-transport-security</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/API-mod-transport-security/issues/">File an issue</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/API-mod-transport-security/commits/">Commit history</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/API-mod-transport-security/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    
    <p class="copyright">
          This document is licensed under 
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/legalcode" class="subfoot"><img class="license" src="https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-by.svg" alt="Logo Creative Commons Attribution 4.0 International Public License"><br> Creative Commons Attribution 4.0 International Public License</a>
        </p>
    <hr title="Separator for header">
  </div>
  <section id="abstract" class="introductory"><h2>Abstract</h2><p>Dit betreft een technische module is die een aantal eisen invult op het gebied van transport security &amp; http security.</p>
</section>
  <section id="sotd" class="introductory"><h2>Status of This Document</h2><p>This is the definitive version of this document. Edits resulting from consultations have been applied.</p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#goal"><bdi class="secno">1.1 </bdi>Goal</a></li><li class="tocline"><a class="tocxref" href="#status"><bdi class="secno">1.2 </bdi>Status</a></li><li class="tocline"><a class="tocxref" href="#authors"><bdi class="secno">1.3 </bdi>Authors</a></li><li class="tocline"><a class="tocxref" href="#reading-guide"><bdi class="secno">1.4 </bdi>Reading Guide</a></li><li class="tocline"><a class="tocxref" href="#extensions"><bdi class="secno">1.5 </bdi>Extensions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#transport-security"><bdi class="secno">2. </bdi>Transport Security</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction-0"><bdi class="secno">2.1 </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#transport-security-0"><bdi class="secno">2.2 </bdi>Transport security</a></li><li class="tocline"><a class="tocxref" href="#http-level-security"><bdi class="secno">2.3 </bdi>HTTP-level Security</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#security-headers"><bdi class="secno">2.3.1 </bdi>Security Headers</a></li><li class="tocline"><a class="tocxref" href="#cors-policy"><bdi class="secno">2.3.2 </bdi>CORS-policy</a></li><li class="tocline"><a class="tocxref" href="#browser-based-applications"><bdi class="secno">2.3.3 </bdi>Browser-based applications</a></li><li class="tocline"><a class="tocxref" href="#restrict-http-methods"><bdi class="secno">2.3.4 </bdi>Restrict HTTP methods</a></li><li class="tocline"><a class="tocxref" href="#validate-content-types"><bdi class="secno">2.3.5 </bdi>Validate content types</a></li><li class="tocline"><a class="tocxref" href="#http-return-code"><bdi class="secno">2.3.6 </bdi>HTTP Return Code</a></li><li class="tocline"><a class="tocxref" href="#http-header-filtering"><bdi class="secno">2.3.7 </bdi>HTTP header filtering</a></li><li class="tocline"><a class="tocxref" href="#error-handling"><bdi class="secno">2.3.8 </bdi>Error handling</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">A.1 </bdi>Normative references</a></li></ol></li></ol></nav>
  <section id="conformance" class="notoc"><div class="header-wrapper"><h2 id="conformance-0">Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for this Section"></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">NOT RECOMMENDED</em>, <em class="rfc2119">RECOMMENDED</em>, and <em class="rfc2119">SHOULD</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p></section>
  <section class="informative" id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
<section id="goal"><div class="header-wrapper"><h3 id="x1-1-goal"><bdi class="secno">1.1 </bdi>Goal</h3><a class="self-link" href="#goal" aria-label="Permalink for Section 1.1"></a></div>
<p>More and more governmental organizations offer REST APIs (henceforth abbreviated as APIs), in addition to existing interfaces like SOAP and WFS. These APIs aim to be developer-friendly and easy to implement. While this is a commendable aim, it does not shield a developer from a steep learning curve getting to know every new API, in particular when every individual API is designed using different patterns and conventions.</p>
<p>This document aims to describe a widely applicable set of design rules for the unambiguous provisioning of REST APIs. The primary goal is to offer guidance for organizations designing new APIs, with the purpose of increasing developer experience (DX) and interoperability between APIs. Hopefully, many organizations will adopt these design rules in their corporate API strategies and provide feedback about exceptions and additions to subsequently improve these design rules.</p>
</section><section id="status"><div class="header-wrapper"><h3 id="x1-2-status"><bdi class="secno">1.2 </bdi>Status</h3><a class="self-link" href="#status" aria-label="Permalink for Section 1.2"></a></div>
<p>This version of the design rules has been submitted to Forum Standaardisatie for inclusion on the Comply or Explain list of mandatory standards in the Dutch Public Sector. This document originates from the document <a href="https://docs.geostandaarden.nl/api/vv-hr-API-Strategie-20190715/">API Strategie voor de Nederlandse Overheid</a>, which was recently split into separate sub-documents.</p>
</section><section id="authors"><div class="header-wrapper"><h3 id="x1-3-authors"><bdi class="secno">1.3 </bdi>Authors</h3><a class="self-link" href="#authors" aria-label="Permalink for Section 1.3"></a></div>
<p>Despite the fact that two authors are mentioned in the list of authors, this document is the result of a collaborative effort by the members of the <em>API Design Rules Working Group</em>.</p>
</section><section id="reading-guide"><div class="header-wrapper"><h3 id="x1-4-reading-guide"><bdi class="secno">1.4 </bdi>Reading Guide</h3><a class="self-link" href="#reading-guide" aria-label="Permalink for Section 1.4"></a></div>
<p>This document is part of the <em>Nederlandse API Strategie</em>.</p>
<p>The Nederlandse API Strategie consists of <a href="https://www.geonovum.nl/themas/kennisplatform-apis#APIStrategie">a set of distinct documents</a>.</p>
<table class="simple">
<thead>
<tr>
<th>Status</th>
<th>Description &amp; Link</th>
</tr>
</thead>
<tbody><tr>
<td>Informative</td>
<td><a href="https://geonovum.github.io/KP-APIs/API-strategie-algemeen/Inleiding/">Inleiding NL API Strategie</a></td>
</tr>
<tr>
<td>Informative</td>
<td><a href="https://geonovum.github.io/KP-APIs/API-strategie-algemeen/Architectuur/">Architectuur NL API Strategie</a></td>
</tr>
<tr>
<td>Informative</td>
<td><a href="https://geonovum.github.io/KP-APIs/API-strategie-algemeen/Gebruikerswensen/">Gebruikerswensen NL API Strategie</a></td>
</tr>
<tr>
<td>Normative</td>
<td><a href="https://publicatie.centrumvoorstandaarden.nl/api/adr/">API Design Rules (ADR)</a></td>
</tr>
<tr>
<td>Normative</td>
<td><a href="https://forumstandaardisatie.nl/open-standaarden/openapi-specification">Open API Specification (OAS)</a></td>
</tr>
<tr>
<td>Normative</td>
<td><a href="https://publicatie.centrumvoorstandaarden.nl/api/oauth/">NL GOV OAuth profiel</a></td>
</tr>
<tr>
<td>Normative</td>
<td><a href="https://publicatie.centrumvoorstandaarden.nl/dk/restapi/">Digikoppeling REST API koppelvlak specificatie</a></td>
</tr>
<tr>
<td>Normative module</td>
<td><a href="https://docs.geostandaarden.nl/api/API-Strategie-mod-geo/">GEO module</a></td>
</tr>
<tr>
<td>Normative module</td>
<td><a href="https://geonovum.github.io/KP-APIs/API-strategie-modules/transport-security/">Transport Security module</a></td>
</tr>
</tbody></table>
<p>Before reading this document it is advised to gain knowledge of the informative documents, in particular the <a href="https://geonovum.github.io/KP-APIs/API-strategie-algemeen/Architectuur/">Architecture</a>.</p>
<p>An overview of all current documents is available in this Dutch infographic:</p>
<figure id="fig-nl-api-strategie-infographic">
  <object data="https://geonovum.github.io/KP-APIs/media/API_infographic.svg" type="image/svg+xml" id="infographic">NL API Strategie Infographic</object>
  <figcaption><a class="self-link" href="#fig-nl-api-strategie-infographic">Figure <bdi class="figno">1</bdi></a> <span class="fig-title">NL API Strategie Infographic</span></figcaption>
</figure>

</section><section id="extensions"><div class="header-wrapper"><h3 id="x1-5-extensions"><bdi class="secno">1.5 </bdi>Extensions</h3><a class="self-link" href="#extensions" aria-label="Permalink for Section 1.5"></a></div>
<div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span></div><aside class="">
In addition to this (normative) document, separate modules are being written to provide a set of extensions. These modules are all separate documents and exists in a <a href="https://geonovum.github.io/KP-APIs/">latest editor's draft</a> (<i>Werkversie</i> in Dutch). The latest editor's draft is actively being worked on and can be found on <a href="https://github.com/Geonovum/KP-APIs">GitHub</a>. It contains the most recent changes.
</aside></div></section></section>
  <section id="transport-security"><div class="header-wrapper"><h2 id="x2-transport-security"><bdi class="secno">2. </bdi>Transport Security</h2><a class="self-link" href="#transport-security" aria-label="Permalink for Section 2."></a></div>
<section id="introduction-0"><div class="header-wrapper"><h3 id="x2-1-introduction"><bdi class="secno">2.1 </bdi>Introduction</h3><a class="self-link" href="#introduction-0" aria-label="Permalink for Section 2.1"></a></div>
<p>This section describes security principles, concepts and technologies to apply when working with APIs. Controls need to be applied for the security objectives of integrity, confidentiality and availability of the API and services and data provided thereby. The (new draft of the) <a href="https://docs.geostandaarden.nl/api/cv-hr-API-Strategie-20210628/#architectuur">architecture section of the API strategy</a> contains architecture patterns for implementing Transport security.</p>
<p>The scope of this section is limited to generic security controls that directly influence the visible parts of an API. Effectively, only security standards directly applicable to interactions are discussed here.
In order to meet the complete security objectives, every implementer <em class="rfc2119">MUST</em> also apply a range of controls not mentioned in this section.</p>
<p>Note: security controls for signing and encrypting of application level messages will be part of a separate extension, <a href="https://geonovum.github.io/KP-APIs/API-strategie-modules/encryption/">Signing and Encryption</a>.</p>
</section><section id="transport-security-0"><div class="header-wrapper"><h3 id="x2-2-transport-security"><bdi class="secno">2.2 </bdi>Transport security</h3><a class="self-link" href="#transport-security-0" aria-label="Permalink for Section 2.2"></a></div>
<p>One should secure all APIs assuming they can be accessed from any location on the internet. Information <em class="rfc2119">MUST</em> be exchanged over TLS-based secured connections. No exceptions, so everywhere and always. This is <a href="https://wetten.overheid.nl/BWBR0048156/2023-07-01">required by law</a>. One <em class="rfc2119">SHOULD</em> follow <a href="https://english.ncsc.nl/publications/publications/2021/january/19/it-security-guidelines-for-transport-layer-security-2.1">the latest NCSC guidelines for TLS</a></p>
<p><span id="api-11"></span></p>
<div class="rule" id="/transport/tls">
  <p class="rulelab"><strong>/transport/tls</strong>: Secure connections using TLS</p>
  <p>Secure connections using TLS following the latest NCSC guidelines [<cite><a class="bibref" data-link-type="biblio" href="#bib-ncsc.tls" title="ICT-beveiligingsrichtlijnen voor Transport Layer Security (TLS)">NCSC.TLS</a></cite>].</p>
  <p>Since the connection is always secured, the access method can be straightforward. This allows the application of basic access tokens instead of encrypted access tokens.</p>
</div>

<p>Even when using TLS-based secured connections information in URIs is not secured. URIs can be cached and logged outside of the servers controlled by clients and servers. Any information contained in them should therfor be considered readable by anyone with access to the netwerk being used (in case of the internet the whole world) and <em class="rfc2119">MUST NOT</em> contain any sensitive information. Neither client secrets used for authentication, privacy sensitive informations suchs as BSNs nor any other information which should not be shared. Be aware that queries (anything after the '?' in a URI) are also part of an URI.</p>
<p><span id="api-58"></span></p>
<div class="rule" id="/transport/no-sensitive-uris">
  <p class="rulelab"><strong>/transport/no-sensitive-uris</strong>: No sensitive information in URIs</p>
  <p>Do not put any sensitive information in URIs</p>
  <p>Even when the connection is secure URIs can be cached and logged, in systems outside the control of client and/or server.</p>
</div>

<p><strong>How to test</strong>
Sensitive information URIS is not machine testable and therfor not part of automated tests. It should be part of any security audit performed by human experts. </p>
<p>The usage of TLS is machine testable. The test is designed for maximum automation. To test, adherence to NCSC reccomendations should be tested. The serverside is what will be tested, only control over the server is assumed for testing. A testing client will be employed to test adherence of the server. Supporting any protocols, algorithms, key sizes, options or ciphers dat are deemed insufficient or phase out by NCSC will lead to failure on the automated test. Both positive and negative scenario's are part of the test. Testing that a subset of good and sufficient reccomendations are supported and testing that phase out and insufficient reccomendations are not. A manual exception to the automated test results can be made when phase out reccomendations are supported. The API provider will have to provide clear documentation for the phase out schedule.  </p>
</section><section id="http-level-security"><div class="header-wrapper"><h3 id="x2-3-http-level-security"><bdi class="secno">2.3 </bdi>HTTP-level Security</h3><a class="self-link" href="#http-level-security" aria-label="Permalink for Section 2.3"></a></div>
<p>The guidelines and principles defined in this extension are client agnostic. When implementing a client agnostic API, one <em class="rfc2119">SHOULD</em> at least facilitate that multi-purpose generic HTTP-clients like browsers are able to securely interact with the API. When implementing an API for a specific client it may be possible to limit measures as long as it ensures secure access for this specific client. Nevertheless it is advised to review the following security measures, which are mostly inspired by the <a href="https://cheatsheetseries.owasp.org/cheatsheets/REST_Security_Cheat_Sheet.html">OWASP REST Security Cheat Sheet</a></p>
<p>Even while remaining client agnostic, clients can be classified in four major groups. This is much in line with common practice in OAuth2. The groups are:</p>
<ol>
<li>Web applications.</li>
<li>Native applications.</li>
<li>Browser-based applications.</li>
<li>System-to-system applications.</li>
</ol>
<p>This section contains elements that apply to the generic classes of clients listed above. Although not every client implementation has a need for all the specifications referenced below, a client agnostic API <em class="rfc2119">SHOULD</em> provide these to facilitate any client to implement relevant security controls.</p>
<p>Most specifications referenced in this section are applicable to the first three classes of clients listed above.
Security considerations for native applications are provided in [OAUth2 for Native Apps]](<a href="https://tools.ietf.org/html/rfc8252">https://tools.ietf.org/html/rfc8252</a>), much of which can help non-OAuth2 based implementations as well.
For browser-based applications a subsection is included with additional details and information.
System-to-system (sometimes called machine-to-machine) may have a need for the listed specifications as well. Note that different usage patterns may be applicable in contexts with system-to-system clients, see above under Client Authentication.</p>
<section id="security-headers"><div class="header-wrapper"><h4 id="x2-3-1-security-headers"><bdi class="secno">2.3.1 </bdi>Security Headers</h4><a class="self-link" href="#security-headers" aria-label="Permalink for Section 2.3.1"></a></div>
<div class="rule" id="/transport/security-headers">
  <p class="rulelab"><strong>/transport/security-headers</strong>: Use mandatory security headers in API all responses</p>
  <p>Return API security headers in all server responses to instruct the client to act in a secure manner</p>
</div>

<p>There are a number of security related headers that can be returned in the HTTP responses to instruct browsers to act in specific ways. However, some of these headers are intended to be used with HTML responses, and as such may provide little or no security benefits on an API that does not return HTML. The following headers <em class="rfc2119">SHOULD</em> be included in all API responses:</p>
<table class="simple">
<thead>
<tr>
<th>Header</th>
<th>Rationale</th>
</tr>
</thead>
<tbody><tr>
<td><code>Cache-Control: no-store</code></td>
<td>Prevent sensitive information from being cached.</td>
</tr>
<tr>
<td><code>Content-Security-Policy: frame-ancestors 'none'</code></td>
<td>To protect against drag-and-drop style clickjacking attacks.</td>
</tr>
<tr>
<td><code>Content-Type</code></td>
<td>To specify the content type of the response. This <em class="rfc2119">SHOULD</em> be <code>application/json</code> for JSON responses.</td>
</tr>
<tr>
<td><code>Strict-Transport-Security</code></td>
<td>To require connections over HTTPS and to protect against spoofed certificates.</td>
</tr>
<tr>
<td><code>X-Content-Type-Options: nosniff</code></td>
<td>To prevent browsers from performing MIME sniffing, and inappropriately interpreting responses as HTML.</td>
</tr>
<tr>
<td><code>X-Frame-Options: DENY</code></td>
<td>To protect against drag-and-drop style clickjacking attacks.</td>
</tr>
<tr>
<td><code>Access-Control-Allow-Origin</code></td>
<td>To relax the 'same origin' policy and allow cross-origin access. See CORS-policy below</td>
</tr>
</tbody></table>
<p>Note that strict transport security is not only mandated by this module <a href="https://wetten.overheid.nl/BWBR0048156/2023-07-01">but also by law</a>. </p>
<p>The headers below are only intended to provide additional security when responses are rendered as HTML. As such, if the API will never return HTML in responses, then these headers may not be necessary. However, if there is any uncertainty about the function of the headers, or the types of information that the API returns (or may return in future), then it is <em class="rfc2119">RECOMMENDED</em> to include them as part of a defense-in-depth approach.</p>
<table class="simple">
<thead>
<tr>
<th>Header</th>
<th>Rationale</th>
</tr>
</thead>
<tbody><tr>
<td><code>Content-Security-Policy: default-src 'none'</code></td>
<td>The majority of CSP functionality only affects pages rendered as HTML.</td>
</tr>
<tr>
<td><code>Feature-Policy: 'none'</code></td>
<td>Feature policies only affect pages rendered as HTML.</td>
</tr>
<tr>
<td><code>Referrer-Policy: no-referrer</code></td>
<td>Non-HTML responses <em class="rfc2119">SHOULD</em> not trigger additional requests.</td>
</tr>
</tbody></table>
<p>In addition to the above listed HTTP security headers, web- and browser-based applications <em class="rfc2119">SHOULD</em> apply Subresource Integrity <a href="https://www.w3.org/TR/SRI/">SRI</a>. When using third-party hosted contents, e.g. using a Content Delivery Network, this is even more relevant. While this is primarily a client implementation concern, it may affect the API when it is not strictly segregated or for example when shared supporting libraries are offered.</p>
<p><strong>How to test</strong>
The precense of the mandatory security headers can be tested in an automated way. A test client makes a call to the API root. The response is tested for the precense of mandatory headers.</p>
</section><section id="cors-policy"><div class="header-wrapper"><h4 id="x2-3-2-cors-policy"><bdi class="secno">2.3.2 </bdi>CORS-policy</h4><a class="self-link" href="#cors-policy" aria-label="Permalink for Section 2.3.2"></a></div>
<p><span id="api-50"></span></p>
<div class="rule" id="/transport/cors">
  <p class="rulelab"><strong>/transport/cors</strong>: Use CORS to control access</p>
  <p>Use CORS to restrict access from other domains (if applicable).</p>
</div>

<p>Modern web browsers use Cross-Origin Resource Sharing (CORS) to minimize the risk associated with cross-site HTTP-requests. By default browsers only allow 'same origin' access to resources. This means that responses on requests to another <code>[scheme]://[hostname]:[port]</code> than the <code>Origin</code> request header of the initial request will not be processed by the browser. To enable cross-site requests API's can return a <code>Access-Control-Allow-Origin</code> response header. It is <em class="rfc2119">RECOMMENDED</em> to use a whitelist to determine the validity of different cross-site request. To do this check the <code>Origin</code> header of the incoming request and check if the domain in this header is on the whitelist. If this is the case, set the incoming <code>Origin</code> header in the <code>Access-Control-Allow-Origin</code> response header.</p>
<p>Using a wildcard <code>*</code> in the <code>Access-Control-Allow-Origin</code> response header is <em class="rfc2119">NOT RECOMMENDED</em>, because it disables CORS-security measures. Only for an open API which has to be accessed by numerous other websites this is appropriate.</p>
<p><strong>How to test</strong>
Tests of this design rule can only be performed when the intended client is known to the tester. A thest can be performed when this information is provided by the API provider. Otherwise no conclusive test result can be reached. </p>
</section><section id="browser-based-applications"><div class="header-wrapper"><h4 id="x2-3-3-browser-based-applications"><bdi class="secno">2.3.3 </bdi>Browser-based applications</h4><a class="self-link" href="#browser-based-applications" aria-label="Permalink for Section 2.3.3"></a></div>
<p>A specific subclass of clients are browser-based applications, that require the presence of particular security controls to facilitate secure implementation. Clients in this class are also known as <em>user-agent-based</em> or <em>single-page-applications</em> (SPA).
As with the (draft) <a href="https://tools.ietf.org/html/draft-ietf-oauth-browser-based-apps-07">OAuth 2.0 for Browser-Based Apps</a>, browser-based application can be split into three architectural patterns:</p>
<ul>
<li>JavaScript applications with a Backend; with this class of applications, the Backend is the confidential client and should intermediate any interaction, with tokens never ending up in the browser. Effectively, these are not different from regular web-application for this security facet, even though they leverage JavaScript for implementation.</li>
<li>JavaScript applications that share a domain with the API (resource server); these can leverage cookies marked as HTTP-Only, Secure and SameSite.</li>
<li>JavaScript applications without a Backend; these clients are considered public clients, are potentially more suspect to several types of attacks, including Cross-Site Scripting (XSS), Cross Site Request Forgery (CSRF) and OAuth token theft. In order to support these clients, the Cross-Origin Resource Sharing (CORS) policy mentioned above is critical and <em class="rfc2119">MUST</em> be supported.</li>
</ul>
<p>All browser-based application <em class="rfc2119">SHOULD</em> follow the best practices specified in <a href="https://tools.ietf.org/html/draft-ietf-oauth-browser-based-apps-07">OAuth 2.0 for Browser-Based Apps</a>.</p>
</section><section id="restrict-http-methods"><div class="header-wrapper"><h4 id="x2-3-4-restrict-http-methods"><bdi class="secno">2.3.4 </bdi>Restrict HTTP methods</h4><a class="self-link" href="#restrict-http-methods" aria-label="Permalink for Section 2.3.4"></a></div>
<p>Apply a whitelist of permitted HTTP Methods e.g. <code>GET</code>, <code>POST</code>, <code>PUT</code>. Reject all requests not matching the whitelist with HTTP response code <code>405 Method not allowed</code>.</p>
</section><section id="validate-content-types"><div class="header-wrapper"><h4 id="x2-3-5-validate-content-types"><bdi class="secno">2.3.5 </bdi>Validate content types</h4><a class="self-link" href="#validate-content-types" aria-label="Permalink for Section 2.3.5"></a></div>
<p>A REST request or response body <em class="rfc2119">SHOULD</em> match the intended content type in the header. Otherwise this could cause misinterpretation at the consumer/producer side and lead to code injection/execution.</p>
<ul>
<li>Reject requests containing unexpected or missing content type headers with HTTP response status <code>406 Unacceptable</code> or <code>415 Unsupported Media Type</code>.</li>
<li>Avoid accidentally exposing unintended content types by explicitly defining content types e.g. Jersey (Java) <code>@consumes("application/json"); @produces("application/json")</code>. This avoids XXE-attack vectors for example.</li>
</ul>
<p>It is common for REST services to allow multiple response types (e.g. <code>application/xml</code> or <code>application/json</code>, and the client specifies the preferred order of response types by the Accept header in the request.</p>
<ul>
<li>Do NOT simply copy the <code>Accept</code> header to the <code>Content-type</code> header of the response.</li>
<li>Reject the request (ideally with a <code>406 Not Acceptable</code> response) if the Accept header does not specifically contain one of the allowable types.</li>
</ul>
<p>Services (potentially) including script code (e.g. JavaScript) in their responses <em class="rfc2119">MUST</em> be especially careful to defend against header injection attack.</p>
<ul>
<li>Ensure sending intended content type headers in your response matching your body content e.g. <code>application/json</code> and not <code>application/javascript</code>.</li>
</ul>
</section><section id="http-return-code"><div class="header-wrapper"><h4 id="x2-3-6-http-return-code"><bdi class="secno">2.3.6 </bdi>HTTP Return Code</h4><a class="self-link" href="#http-return-code" aria-label="Permalink for Section 2.3.6"></a></div>
<p>HTTP defines status codes. When designing a REST API, don't just use <code>200</code> for success or <code>404</code> for error. Always use the semantically appropriate <a href="https://tools.ietf.org/html/rfc7231#section-6">status code</a> for the response.</p>
</section><section id="http-header-filtering"><div class="header-wrapper"><h4 id="x2-3-7-http-header-filtering"><bdi class="secno">2.3.7 </bdi>HTTP header filtering</h4><a class="self-link" href="#http-header-filtering" aria-label="Permalink for Section 2.3.7"></a></div>
<p>Realizations may rely on internal usage of HTTP-Headers. Information for processing requests and responses can be passed between components, that can have security implications.
For instance, this is commonly practices between a reverse proxy or TLS-offloader and an application server. Additional HTTP headers are used in such example to pass an original IP-address or client certificate.</p>
<p>Implementations <em class="rfc2119">MUST</em> consider filtering both inbound and outbound traffic for HTTP-headers used internally.
Primary focus for inbound filtering is to prevent injection of malicious headers on requests.
For outbound filtering, the main concern is leaking of information.</p>
</section><section id="error-handling"><div class="header-wrapper"><h4 id="x2-3-8-error-handling"><bdi class="secno">2.3.8 </bdi>Error handling</h4><a class="self-link" href="#error-handling" aria-label="Permalink for Section 2.3.8"></a></div>
<ul>
<li>Respond with generic error messages - avoid revealing details of the failure unnecessarily.</li>
<li>Do not pass technical details (e.g. call stacks or other internal hints) to the client.</li>
</ul>
</section></section></section>  
  



<section id="references" class="appendix"><div class="header-wrapper"><h2 id="a-references"><bdi class="secno">A. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></div><section id="normative-references">
    <div class="header-wrapper"><h3 id="a-1-normative-references"><bdi class="secno">A.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix A.1"></a></div>
    <dl class="bibliography"><dt id="bib-ncsc.tls">[NCSC.TLS]</dt><dd>
      <a href="https://www.ncsc.nl/documenten/publicaties/2021/januari/19/ict-beveiligingsrichtlijnen-voor-transport-layer-security-2.1"><cite>ICT-beveiligingsrichtlijnen voor Transport Layer Security (TLS)</cite></a>. NCSC. Januari 2021. URL: <a href="https://www.ncsc.nl/documenten/publicaties/2021/januari/19/ict-beveiligingsrichtlijnen-voor-transport-layer-security-2.1">https://www.ncsc.nl/documenten/publicaties/2021/januari/19/ict-beveiligingsrichtlijnen-voor-transport-layer-security-2.1</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><div class="sidelabel">Logius Guide - Definitive version</div><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>