<!DOCTYPE html><html lang="nl"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<meta name="generator" content="ReSpec 28.1.0 Logius profile 20220106">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
:is(aside,div).example{border-left-width:.5em;border-left-style:solid;border-color:#e0cb52;background:#fcfaee}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
.example pre{background-color:rgba(0,0,0,.03)}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font:small Helvetica Neue,sans-serif,Droid Sans Fallback;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
  
<title>Digikoppeling Koppelvlakstandaard WUS 3.8</title>
  
  
<link rel="shortcut icon" type="image/x-icon" href="https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/logius.ico">
  
  
<link rel="stylesheet" type="text/css" href="./media/style.css">

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
a[href].self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
h2,h3,h4,h5,h6{position:relative}
aside.example .marker>a.self-link{color:inherit}
:is(h2,h3,h4,h5,h6)>a.self-link{border:none;color:inherit;font-size:83%;height:2em;left:-1.6em;opacity:.5;position:absolute;text-align:center;text-decoration:none;top:0;transition:opacity .2s;width:2em}
:is(h2,h3,h4,h5,h6)>a.self-link::before{content:"§";display:block}
@media (max-width:767px){
dd{margin-left:0}
:is(h2,h3,h4,h5,h6)>a.self-link{left:auto;top:auto}
}
@media print{
.removeOnSave{display:none}
}
</style>
<meta name="description" content="Dit document beschrijft de functionele specificaties voor de Digikoppeling
    koppelvlak standaard WUS">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "DEF",
  "specType": "ST",
  "pubDomain": "dk",
  "shortName": "wus",
  "publishDate": "2020-10-06",
  "publishVersion": "3.8",
  "license": "cc-by-nd",
  "doJsonLd": true,
  "editors": [
    {
      "name": "Peter Haasnoot",
      "url": "https://logius.nl/standaarden"
    },
    {
      "name": "Pieter Hering",
      "url": "https://logius.nl/standaarden"
    }
  ],
  "authors": [
    {
      "name": "Logius",
      "mailto": "digikoppeling@logius.nl",
      "url": "mailto:digikoppeling@logius.nl"
    }
  ],
  "github": "https://github.com/Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS",
  "addSectionLinks": true,
  "a11y": false,
  "alternateFormats": [
    {
      "label": "pdf",
      "uri": "Digikoppeling-Koppelvlakstandaard-WUS.pdf"
    }
  ],
  "nl_emailComments": "digikoppeling@logius.nl",
  "nl_addReleaseTagTitle": true,
  "nl_markdownSplitH1sections": false,
  "nl_github": {
    "revision": "https://github.com/Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS/commits/"
  },
  "nl_organisationName": "Logius",
  "nl_organisationPrefix": "LS-",
  "nl_markdownTableClass": "dkkvs",
  "nl_markdownEmbedImageInFigure": true,
  "nl_organisationStylesURL": "https://publicatie.centrumvoorstandaarden.nl/respec/style/",
  "nl_organisationPublishURL": "https://publicatie.centrumvoorstandaarden.nl/",
  "nl_logo": {
    "src": "https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/figure-logius.svg",
    "alt": "Logius",
    "id": "Logius",
    "height": 77,
    "width": 44,
    "url": "https://www.logius.nl/standaarden"
  },
  "localBiblio": {
    "Beveiligingsdocument": {
      "href": "https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf",
      "title": "Digikoppeling Beveiligingsstandaarden en voorschriften",
      "date": "2020",
      "publisher": "Logius",
      "id": "beveiligingsdocument"
    },
    "Certificaten": {
      "href": "https://cert.pkioverheid.nl/",
      "title": "PkIoverheid certificaten",
      "publisher": "Logius",
      "id": "certificaten"
    },
    "Logius": {
      "href": "https://logius.nl/digikoppeling",
      "title": "Logius Digikoppeling",
      "publisher": "Logius",
      "id": "logius"
    },
    "Compliance": {
      "href": "https://portaal.digikoppeling.nl",
      "title": "Digikoppeling Compliance Voorziening",
      "publisher": "Logius",
      "id": "compliance"
    },
    "Voorbeelden": {
      "href": "https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip",
      "title": "Digikoppeling WUS voorbeelden (zip)",
      "publisher": "Logius",
      "id": "voorbeelden"
    }
  },
  "publishISODate": "2020-10-06T00:00:00.000Z",
  "generatedSubtitle": "Vastgestelde versie 06 oktober 2020"
}</script>
<link rel="stylesheet" href="https://publicatie.centrumvoorstandaarden.nl/respec/style/LS-DEF.css"></head>

<body class="h-entry toc-inline"><div class="head">
    <a class="logo" href="https://www.logius.nl/standaarden"><img alt="Logius" height="77" id="Logius" src="https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/figure-logius.svg" width="44">
  </a> <h1 id="title" class="title">Digikoppeling Koppelvlakstandaard WUS 3.8</h1>
    
    <h2>
      Logius Standaard<br>
      Vastgestelde versie
      <time class="dt-published" datetime="2020-10-06">06 oktober 2020</time>
    </h2>
	<a lang="nl" href="https://publicatie.centrumvoorstandaarden.nl/">Overzicht standaarden</a>
    <dl>
      <dt>Deze versie:</dt><dd class="status">
              <a class="u-url status" href="https://publicatie.centrumvoorstandaarden.nl/dk/wus/3.8">https://publicatie.centrumvoorstandaarden.nl/dk/wus/3.8</a>
            </dd><dt>Laatst gepubliceerde versie:</dt><dd>
              <a href="https://publicatie.centrumvoorstandaarden.nl/dk/wus/">https://publicatie.centrumvoorstandaarden.nl/dk/wus/</a>
            </dd>
      <dt>Laatste werkversie:</dt><dd><a href="https://logius-standaarden.github.io/Digikoppeling-Koppelvlakstandaard-WUS/">https://logius-standaarden.github.io/Digikoppeling-Koppelvlakstandaard-WUS/</a></dd>
      
      
      
      
      
      <dt>Redacteurs:</dt>
      <dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://logius.nl/standaarden">Peter Haasnoot</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://logius.nl/standaarden">Pieter Hering</a>
  </dd>
      
      <dt>Auteur:</dt><dd class="editor p-author h-card vcard">
    <a class="ed_mailto u-email email p-name" href="mailto:digikoppeling@logius.nl">Logius</a>
  </dd>
      <dt>Doe mee:</dt><dd>
    <a href="https://github.com/Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS/">GitHub Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS/issues/">Dien een melding in</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS/commits/">Revisiehistorie</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/Digikoppeling-Koppelvlakstandaard-WUS/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    <p lang="en">
          This document is also available in this non-normative format:
          <a rel="alternate" href="Digikoppeling-Koppelvlakstandaard-WUS.pdf">pdf</a>
        </p>
    <p class="copyright" lang="en">
          This document is licensed under a
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/" class="subfoot">Creative Commons Attribution 4.0 License</a>.
        </p>
    <hr title="Separator for header">
  </div>
  <section id="abstract" class="introductory"><h2 id="samenvatting">Samenvatting<a class="self-link" href="#abstract" aria-label="Permalink for Section"></a></h2><p>Dit document beschrijft de functionele specificaties voor de Digikoppeling
    koppelvlak standaard WUS</p>

<p>Het document is bestemd voor architecten en ontwikkelaars die op basis van WUS
    gegevens willen uitwisselen via Digikoppeling.</p>

<p>Alle Digikoppeling webservices die op WUS gebaseerd zijn, moeten conformeren aan
    de koppelvlakstandaard WUS. Deze wordt tot in detail in dit document
    gespecificeerd. Doel van dit document is ontwikkelaars te informeren wat deze
    koppelvlakstandaard nu precies inhoudt en waar zij zich aan moeten conformeren.
    Het document is bestemd voor architecten en ontwikkelaars die op basis van WUS
    gegevens willen uitwisselen via Digikoppeling. Het gaat hierbij om zowel service
    providers als service requesters (clients).</p></section>
  <section id="sotd" class="introductory"><h2 id="status-van-dit-document">Status van dit document<a class="self-link" href="#sotd" aria-label="Permalink for Section"></a></h2>Dit is de definitieve versie van de  standaard. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.<p>Het OBDO heeft op advies van het Forum Standaardisatie deze versie vastgesteld.</p></section><nav id="toc"><h2 class="introductory" id="inhoudsopgave">Inhoudsopgave</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Samenvatting</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status van dit document</a></li><li class="tocline"><a class="tocxref" href="#inleiding"><bdi class="secno">1. </bdi>Inleiding</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#doel-en-doelgroep"><bdi class="secno">1.1 </bdi>Doel en Doelgroep</a></li><li class="tocline"><a class="tocxref" href="#opbouw-digikoppeling-documentatie"><bdi class="secno">1.2 </bdi>Opbouw Digikoppeling documentatie</a></li><li class="tocline"><a class="tocxref" href="#koppelvlak-koppelvlakstandaard"><bdi class="secno">1.3 </bdi>Koppelvlak &amp; koppelvlakstandaard</a></li><li class="tocline"><a class="tocxref" href="#opbouw-van-dit-document"><bdi class="secno">1.4 </bdi>Opbouw van dit document</a></li></ol></li><li class="tocline"><a class="tocxref" href="#koppelvlakstandaard-wus"><bdi class="secno">2. </bdi>Koppelvlakstandaard WUS</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#inleiding-0"><bdi class="secno">2.1 </bdi>Inleiding</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#wsdl"><bdi class="secno">2.1.1 </bdi>WSDL</a></li><li class="tocline"><a class="tocxref" href="#resulterende-berichtheaders"><bdi class="secno">2.1.2 </bdi>Resulterende berichtheaders</a></li></ol></li><li class="tocline"><a class="tocxref" href="#ondersteunde-varianten"><bdi class="secno">2.2 </bdi>Ondersteunde varianten</a></li><li class="tocline"><a class="tocxref" href="#compliancevoorzieningen"><bdi class="secno">2.3 </bdi>Compliancevoorzieningen</a></li><li class="tocline"><a class="tocxref" href="#gehanteerde-standaarden"><bdi class="secno">2.4 </bdi>Gehanteerde standaarden</a></li><li class="tocline"><a class="tocxref" href="#voorschriften"><bdi class="secno">2.5 </bdi>Voorschriften</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#service-definitie-wsdl"><bdi class="secno">2.5.1 </bdi>Service definitie WSDL</a></li><li class="tocline"><a class="tocxref" href="#ws-addressing"><bdi class="secno">2.5.2 </bdi>WS-Addressing</a></li><li class="tocline"><a class="tocxref" href="#binaire-data"><bdi class="secno">2.5.3 </bdi>Binaire Data</a></li><li class="tocline"><a class="tocxref" href="#beveiliging"><bdi class="secno">2.5.4 </bdi>Beveiliging</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#point-to-point-beveiliging"><bdi class="secno">2.5.4.1 </bdi>Point-to-Point beveiliging</a></li><li class="tocline"><a class="tocxref" href="#end-to-end-beveiliging"><bdi class="secno">2.5.4.2 </bdi>End-to-End beveiliging</a></li></ol></li><li class="tocline"><a class="tocxref" href="#naamgeving-namespaces"><bdi class="secno">2.5.5 </bdi>Naamgeving, namespaces</a></li></ol></li><li class="tocline"><a class="tocxref" href="#foutafhandeling"><bdi class="secno">2.6 </bdi>Foutafhandeling</a></li></ol></li><li class="tocline"><a class="tocxref" href="#digikoppeling-profielen-wus"><bdi class="secno">3. </bdi>Digikoppeling profielen WUS</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#wus-profiel-digikoppeling-2w-be"><bdi class="secno">3.1 </bdi>WUS Profiel Digikoppeling 2W-be</a></li><li class="tocline"><a class="tocxref" href="#wus-profiel-digikoppeling-2w-be-s"><bdi class="secno">3.2 </bdi>WUS Profiel Digikoppeling 2W-be-S</a></li><li class="tocline"><a class="tocxref" href="#wus-profiel-digikoppeling-2w-be-se"><bdi class="secno">3.3 </bdi>WUS Profiel Digikoppeling 2W-be-SE</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">4. </bdi>Conformiteit</a></li><li class="tocline"><a class="tocxref" href="#tof"><bdi class="secno">5. </bdi>Lijst met figuren</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>Referenties</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normatieve-referenties"><bdi class="secno">A.1 </bdi>Normatieve referenties</a></li><li class="tocline"><a class="tocxref" href="#informatieve-referenties"><bdi class="secno">A.2 </bdi>Informatieve referenties</a></li></ol></li></ol></nav>
  <section class="introductory" data-format="markdown"><h1>Documentbeheer</h1><p>Documentbeheer</p><table class="dkkvs">
<thead>
<tr>
<th>Datum</th>
<th>Versie</th>
<th>Auteur</th>
<th>Opmerkingen</th>
</tr>
</thead>
<tbody><tr>
<td>04/04/2016</td>
<td>3.4</td>
<td>Logius</td>
<td>Referenties naar Beveiligingsvoorschriften aangepast naar nieuwe Document Digikoppeling beveiligingsvoorschrift type wsa:TO gecorrigeerd Bijlagen met voorbeelden verwijderd</td>
</tr>
<tr>
<td>01/10/2017</td>
<td>3.5</td>
<td>Logius</td>
<td>Verwijzingen naar WS-RM verwijderd</td>
</tr>
<tr>
<td>23/08/2018</td>
<td>3.6</td>
<td>Logius</td>
<td>RFC 2018-01 OIN in WSA:to/from</td>
</tr>
<tr>
<td>23/10/2018</td>
<td>3.7</td>
<td>Logius</td>
<td>Verscherpingen n.a.v. onderzoek interop problemen.</td>
</tr>
<tr>
<td>06/10/2020</td>
<td>3.8</td>
<td>Logius</td>
<td>RFC 2020-2, RFC 2020-3</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table></section>
  <section class="introductory" data-format="markdown"><h1>Colofon</h1><table class="dkkvs">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Logius Servicecentrum:</td>
<td>Postbus 96810 2509<br>JE Den Haag<br>t. 0900 555 4555 (10 ct p/m)<br>e.<a href="mailto:servicecentrum@logius.nl">servicecentrum@logius.nl</a></td>
</tr>
</tbody></table></section>
  
<section data-format="markdown" id="inleiding"><h2 id="x1-inleiding"><bdi class="secno">1. </bdi>Inleiding<a class="self-link" href="#inleiding" aria-label="Permalink for Section 1."></a></h2><section id="doel-en-doelgroep"><h3 id="x1-1-doel-en-doelgroep"><bdi class="secno">1.1 </bdi>Doel en Doelgroep<a class="self-link" href="#doel-en-doelgroep" aria-label="Permalink for Section 1.1"></a></h3><p>Dit document beschrijft de functionele specificaties voor de Digikoppeling
koppelvlak standaard WUS</p><p>Het document is bestemd voor architecten en ontwikkelaars die op basis van WUS
gegevens willen uitwisselen via Digikoppeling.</p><p>Alle Digikoppeling webservices die op WUS gebaseerd zijn, moeten conformeren aan
de koppelvlakstandaard WUS. Deze wordt tot in detail in dit document
gespecificeerd. Doel van dit document is ontwikkelaars te informeren wat deze
koppelvlakstandaard nu precies inhoudt en waar zij zich aan moeten conformeren.
Het document is bestemd voor architecten en ontwikkelaars die op basis van WUS
gegevens willen uitwisselen via Digikoppeling. Het gaat hierbij om zowel service
providers als service requesters (clients).</p></section><section id="opbouw-digikoppeling-documentatie"><h3 id="x1-2-opbouw-digikoppeling-documentatie"><bdi class="secno">1.2 </bdi>Opbouw Digikoppeling documentatie<a class="self-link" href="#opbouw-digikoppeling-documentatie" aria-label="Permalink for Section 1.2"></a></h3><p>Digikoppeling is beschreven in een set van documenten. Deze set is als volgt
opgebouwd:</p><p><figure id="fig-opbouw-documentatie-digikoppeling"><img src="media/DK_Specificatie_structuur.svg" alt="Overzicht van de onderdelen van de Digikoppeling Standaard, de standaard is onderverdeeld in normatieve en ondersteunende onderdelen" title="Opbouw documentatie Digikoppeling"><figcaption>Figuur <bdi class="figno">1</bdi> <span class="fig-title">Opbouw documentatie Digikoppeling</span></figcaption></figure></p><details>
    <summary> Tekstalternatief </summary>
<ul>
    <li>Digikoppeling Standaard
        <ul>
            <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/beheer/">DK Beheermodel en releasebeleid</a>* </li>
            <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/actueel/">DK Overzicht Actuele Documentatie en Compliance</a>* </li>
            <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/architectuur">DK Architectuur</a>*
                <ul>
                    <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/idauth/">DK Identificatie en Authenticatie</a>*
                        <ul>
                            <li><i> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/gbachtcert/">Digikoppeling Gebruik en Achtergronden Certificaten</a></i>† </li>
                        </ul>
                    </li>
                    <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/beveilig/">DK Beveiligingsstandaarden en voorschriften</a>* </li>
                    <li>Koppelvlakstandaarden
                        <ul>
                            <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/wus/">DK Koppelvlakstandaard WUS</a>*
                                <ul>
                                    <li><i><a href="https://publicatie.centrumvoorstandaarden.nl/dk/bpwus">Best-practice WUS</a></i>† </li>
                                </ul>
                            </li>
                            <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/ebms/">DK Koppelvlakstandaard ebMS2</a>*
                                <ul>
                                    <li> <i><a href="https://publicatie.centrumvoorstandaarden.nl/dk/bpebms">Best-practice ebMS2</a></i>† </li>
                                </ul>
                            </li>
                            <li> <a href="https://publicatie.centrumvoorstandaarden.nl/dk/gb/">DK Koppelvlakstandaard Grote Berichten</a>*
                                <ul>
                                    <li> <i><a href="https://publicatie.centrumvoorstandaarden.nl/dk/bpgb">Best-practice Grote Berichten</a></i>†</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
    <i><a href="https://publicatie.centrumvoorstandaarden.nl/dk/watisdk/">Wat is Digikoppeling</a></i>†
  </li>
        </ul>
    </li>
</ul>
<p>* Normatief document</p>
<p>† Ondersteunend document</p>
</details><p>Dit document beschrijft de WUS variant van de koppelvlakstandaarden. Naast de
Koppelvlakstandaard WUS is er ook de ebMS2-standaard. Die wordt in een apart
document beschreven.</p></section><section id="koppelvlak-koppelvlakstandaard"><h3 id="x1-3-koppelvlak-koppelvlakstandaard"><bdi class="secno">1.3 </bdi>Koppelvlak &amp; koppelvlakstandaard<a class="self-link" href="#koppelvlak-koppelvlakstandaard" aria-label="Permalink for Section 1.3"></a></h3><p>Een koppelvlak is een interface die volgens standaarden de gegevensuitwisseling
vastlegt. Het werken met vaste standaarden is essentieel voor een koppelvlak.
Hierdoor wordt implementatie vergemakkelijkt. Ook wordt het mogelijk diverse
soorten berichten door te sturen met een grote mate van interoperabiliteit,
omdat via de standaard afspraken over hun inhoud gemaakt is.</p><p>Eén van de belangrijkste eisen die door de overheid gesteld worden bij de
inrichting van generieke voorzieningen, is dat er niet veel maatwerk ontwikkeld
hoeft te worden, maar dat er van “off the shelf” commercieel of Open source
geleverde software gebruik gemaakt kan worden. Voor Digikoppeling, dus voor de
logistieke laag, betreft dat het niet willen ontwikkelen van software voor de
adapters.</p><p>Dit doel kan bereikt (benaderd) worden doordat gekozen wordt voor internationale
(de jure of de facto) vastgelegde standaarden, die door “alle” leveranciers
interoperabel zijn geïmplementeerd.</p><p>Een andere eis is dat met name afnemers gebruik kunnen maken van één “stekker”
(één logistiek koppelpunt). Aanbieders dienen hiervoor de nodige voorzieningen
te treffen.</p><p>Een koppelvlakspecificatie beschrijft de eisen die gesteld worden aan de
adapters om interoperabel met elkaar te kunnen communiceren. Digikoppeling gaat
over logistiek, dus over de envelop en niet over de inhoud. De hele set
informatie die tezamen nodig is voor een complete generieke Digikoppeling
koppelvlakdefinitie bestaat uit:</p><ul>
<li>Interfacedefinitie “on the wire”, (voorbeeld)listing van SOAP headers en
  informatie over velden en hun specifieke inhoud.</li>
</ul><p>De voor Digikoppeling vereiste interoperabiliteit van de WUS standaarden van
OASIS en W3C wordt gebaseerd op de profielen (en tests) van OASIS WS-BRSP
(voorheen WS-I).</p></section><section id="opbouw-van-dit-document"><h3 id="x1-4-opbouw-van-dit-document"><bdi class="secno">1.4 </bdi>Opbouw van dit document<a class="self-link" href="#opbouw-van-dit-document" aria-label="Permalink for Section 1.4"></a></h3><p>Hoofdstuk 1 bevat een aantal algemene inleidende onderwerpen.</p><p>Hoofdstuk 2 bevat de kern van de standaard. Deze is onderverdeeld naar
onderwerpen/gebieden: WSDL, WS-Addressing, naamgeving, beveiliging,
betrouwbaarheid en binaire data. Het identificeert de gekozen internationale
(WS-I) profielen die dienen als fundament voor de Digikoppeling
Koppelvlakstandaard WUS. Die keuzes, de nadere invullingen voor Digikoppeling
binnen de ruimte van die standaarden/profielen en specifieke aandachtspunten bij
de keuzes, vormen tezamen de “voorschriften” per onderwerp.</p><p>Hoofdstuk 3 definieert de resulterende Digikoppeling WUS profielen.</p><p>Gehanteerde terminologie: Glossary</p><p>Voor de definities die binnen het Digikoppeling project gehanteerd worden, zie
de ‘Digikoppeling Glossary’ via de onderstaande website.</p><p>Website</p><p>Dit document en andere documentatie is beschikbaar op
<a href="http://www.logius.nl/digikoppeling">www.logius.nl/digikoppeling</a>.</p></section></section>
<section data-format="markdown" id="koppelvlakstandaard-wus"><h2 id="x2-koppelvlakstandaard-wus"><bdi class="secno">2. </bdi>Koppelvlakstandaard WUS<a class="self-link" href="#koppelvlakstandaard-wus" aria-label="Permalink for Section 2."></a></h2><section id="inleiding-0"><h3 id="x2-1-inleiding"><bdi class="secno">2.1 </bdi>Inleiding<a class="self-link" href="#inleiding-0" aria-label="Permalink for Section 2.1"></a></h3><p>WUS is een acroniem voor WSDL, UDDI en SOAP: WUS dus. Daarmee wordt een familie
van internationale standaarden van OASIS en W3C bedoeld; deze worden ook vaak
met WS-* aangeduid. Deze standaarden gaan over application-to-application
webservices.</p><p>Alle Digikoppeling webservices die op WUS gebaseerd zijn, moeten aan deze
koppelvlakstandaard conformeren. Doel van de Koppelvlakstandaard WUS is het
eenduidig en bruikbaar definiëren van het koppelvlak voor WUS. Er zijn daarvoor
de volgende onderwerpen relevant: WSDL met adressering en naamgeving,
beveiliging, betrouwbaarheid, binaire data, resulterende berichtheaders,
profielen van Digikoppeling en compliancevoorzieningen. Deze standaard wordt
verder aangevuld met “Best Practices” en adviezen, beschreven in een apart
document. Alle documentatie over Digikoppeling is te vinden op de <a href="http://www.logius.nl/digikoppeling">Logius
website</a>.</p><section id="wsdl"><h4 id="x2-1-1-wsdl"><bdi class="secno">2.1.1 </bdi>WSDL<a class="self-link" href="#wsdl" aria-label="Permalink for Section 2.1.1"></a></h4><p>Een webservice wordt deels formeel en automatisch verwerkbaar gedefinieerd
(beschrijving – description) door een WSDL. Deze WSDL geeft een beschrijving van
de eisen die ten aanzien van de communicatie gesteld worden. Een WSDL kan onder
andere bestaan uit meerdere schema definities in aparte XSD’s en policy
definities. Gezamenlijk vormt dit een abstracte definitie van de webservice. De
webservice communiceert feitelijk door middel van SOAP berichten, die
gegenereerd worden op basis van de WSDL. Adressering en naamgeving zijn
specifieke aandachtsgebieden.</p></section><section id="resulterende-berichtheaders"><h4 id="x2-1-2-resulterende-berichtheaders"><bdi class="secno">2.1.2 </bdi>Resulterende berichtheaders<a class="self-link" href="#resulterende-berichtheaders" aria-label="Permalink for Section 2.1.2"></a></h4><p>Deze standaard beschrijft per definitie aan welke eisen een Digikoppeling WUS
implementatie moet voldoen. De praktijk leert dat dergelijke eisen vaak erg
abstract zijn en dus gebaat zijn bij voorbeelden. Voorbeelden van berichten zijn
gepubliceerd op de <cite><a href="https://logius.nl/digikoppeling">Logius Digikoppeling</a></cite>. Voorbeelden van WSDL’s zijn beschikbaar als
onderdeel van de <cite><a href="https://portaal.digikoppeling.nl">Digikoppeling Compliance Voorziening</a></cite>.</p></section></section><section id="ondersteunde-varianten"><h3 id="x2-2-ondersteunde-varianten"><bdi class="secno">2.2 </bdi>Ondersteunde varianten<a class="self-link" href="#ondersteunde-varianten" aria-label="Permalink for Section 2.2"></a></h3><p>Om redenen van interoperabiliteit, eenvoud en overzichtelijkheid onderscheidt
deze Digikoppeling Koppelvlakstandaard een tweetal varianten van uitwisselingen.
Elke variant veronderstelt bepaalde voorgedefinieerde keuzes voor parameters als
beveiliging en betrouwbaarheid en is daarmee een “profiel” voor WUS.</p><p>Elke uitwisseling op basis van de WUS-protocollen over Digikoppeling zal moeten
voldoen aan één of een combinatie van de volgende Digikoppeling WUS-varianten:</p><ul>
<li><p><strong>Best Effort:</strong> dit zijn synchrone uitwisselingen die geen faciliteiten
  voor betrouwbaarheid (ontvangstbevestigingen, duplicaateliminatie etc.)
  vereisen. Voorbeelden zijn toepassingen waar het eventueel verloren raken
  van sommige berichten niet problematisch is en waar snelle verwerking
  gewenst is.</p>
</li>
<li><p><strong>End-to-End Security:</strong> een bericht wordt beveiligd tussen de
  uiteindelijke consumer en de uiteindelijke provider, ook wanneer er zich
  intermediairs bevinden in het pad tussen die twee. Het betreft hier
  authenticatie van de consumerorganisatie, conform het Digikoppeling
  authenticatiemodel, waarbij alleen de identiteit van de consumerorganisatie
  relevant is(signing), en encryptie van het bericht (payload inclusief
  attachments) onderweg. Voor de authenticatie en encryptie wordt
  gebruikgemaakt van WS-Security.</p>
</li>
<li><p><strong>Attachments:</strong> één of meerdere bijlagen, naast natuurlijk het reeds bestaande
  (xml) bericht zelf. Dit kan, maar hoeft niet, toegepast te worden in
  combinatie de bovengenoemde profielen: het is dus optioneel.</p>
</li>
<li><p>Vertrouwelijkheid en authenticatie van zender en ontvanger wordt als volgt
  gerealiseerd:</p>
<ul>
<li>voor Point-to-Point Security, door middel van twee-zijdig TLS op</li>
</ul>
</li>
</ul><p> transport-niveau (in het HTTP kanaal). (De toepassing ervan is verplicht
 op alle Digikoppeling versies.)</p><ul>
<li>voor End-to-End Security, door middel van signing (ondertekening) en
 (optioneel) encryptie (versleuteling) op berichtniveau (payload
 inclusief de attachments, ook wel 'bijlagen' genoemd) in combinatie met
 (point-to-point) twee-zijdig TLS in het HTTP kanaal.</li>
</ul><p>De onderstaande tabel geeft in essentie de eigenschappen van de verschillende
Digikoppeling profielen weer. Voor alle profielen wordt tweezijdig TLS gebruikt
op transportniveau (HTTPS).</p><table class="dkkvs">
<thead>
  <tr>
    <td colspan="3">Profile Names</td>
    <td colspan="4">Profile Names</td>
  </tr>
</thead>
<tbody>
  <tr>
    <td colspan="3">Digikoppeling WUS</td>
    <td>2-zijdig TLS</td>
    <td>Signed</td>
    <td>Encrypted</td>
    <td>Attachments</td>
  </tr>
  <tr>
    <td colspan="2">Best Effort</td>
    <td>Digikoppeling 2W-be</td>
    <td>√</td>
    <td>―</td>
    <td>―</td>
    <td>Optional</td>
  </tr>
  <tr>
    <td rowspan="2">End-to-End Security</td>
    <td>Best Effort – Signed</td>
    <td>Digikoppeling 2W-be-S</td>
    <td>√</td>
    <td>√</td>
    <td>―</td>
    <td>Optional</td>
  </tr>
  <tr>
    <td>Best Effort – Encrypted</td>
    <td>Digikoppeling 2W-be-SE</td>
    <td>√</td>
    <td>√</td>
    <td>√</td>
    <td>Optional</td>
  </tr>
</tbody>
</table></section><section id="compliancevoorzieningen"><h3 id="x2-3-compliancevoorzieningen"><bdi class="secno">2.3 </bdi>Compliancevoorzieningen<a class="self-link" href="#compliancevoorzieningen" aria-label="Permalink for Section 2.3"></a></h3><p>Voor de Digikoppeling Koppelvlakstandaard WUS is een compliancevoorzieningen
beschikbaar gesteld, waarmee een ontwikkelaar of beheerder kan testen “of het
berichtenverkeer werkt”. Deze compliancevoorziening is gedefinieerd aan de hand
van de WSDL’s die opvraagbaar zijn op
<cite><a href="https://portaal.digikoppeling.nl">Digikoppeling Compliance Voorziening</a></cite>.</p><p>De volgende interacties zijn beschikbaar:</p><ul>
<li><p>Digikoppeling service requester: wordt gebruikt om een ontwikkelde servicere
  requester (client) te testen.</p>
</li>
<li><p>Digikoppeling service provider: wordt gebruikt om een ontwikkelde service
  provider (service) te testen.</p>
</li>
</ul><p>De documenten over de compliancevoorzieningen zijn te vinden op de [Logius
website]. De [Digikoppeling Compliancevoorziening] zelf is beschikbaar op
<cite><a href="https://portaal.digikoppeling.nl">Digikoppeling Compliance Voorziening</a></cite></p></section><section id="gehanteerde-standaarden"><h3 id="x2-4-gehanteerde-standaarden"><bdi class="secno">2.4 </bdi>Gehanteerde standaarden<a class="self-link" href="#gehanteerde-standaarden" aria-label="Permalink for Section 2.4"></a></h3><p>In dit hoofdstuk worden de verschillende versies van de onderliggende
internationale standaarden vermeld.</p><p>Overwegingen</p><p>Primair wordt gekozen voor de interoperabele profielen van OASIS WS-BRSP
(voorheen WS-I). Het gaat dan om WS-I Basic Profile (BP) 1.2, een set
specificaties van webservices die interoperabiliteit bevorderen. Digikoppeling
kiest voor standaarden die algemeen interoperabel beschikbaar zijn, dat wil
zeggen interoperabel geïmplementeerd zijn in het grootste deel van de
(ontwikkel) tools. De kans daarop is groter bij “final” standaarden dan bij
drafts. Digikoppeling kiest daarom voor WS-I Standaarden met status final.</p><p>De minimaal ondersteunde TLS encryptie algoritmen en sleutellengtes worden
beschreven in het <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>.</p><p>Resulterende beslissingen ten aanzien van standaarden:</p><ul>
<li><p>WS-I BP 1.2; deze is gebaseerd op onderliggende standaarden: SOAP 1.1, WSDL
  1.1 en de te kiezen onderdelen van WS-Addressing en MTOM.</p>
</li>
<li><p>WS-I BSP 1.1 voor berichtbeveiliging op basis van WS-Security.</p>
</li>
<li><p>De TLS versies zoals beschreven in <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>,
  conform de aanbevelingen in WS-I BSP 1.0 voor beveiliging op
  transport/kanaal niveau en aanbevelingen van NIST en NCSC.</p>
</li>
<li><p>WS-I Simple SOAP Binding Profile Version 1.0.</p>
</li>
</ul><p>Bovenstaande standaarden zijn gebaseerd op diverse onderliggende standaarden.
Gevolg is dat de Digikoppeling WUS standaard gebruikmaakt van de volgende set
van standaarden:</p><table class="dkkvs">
<thead>
<tr>
<th>Standaarden</th>
<th>Gevolg van onder andere</th>
</tr>
</thead>
<tbody><tr>
<td>HyperText Transfer Protocol 1.1 (RFC7230 t/m RFC7233)</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>SOAP 1.1</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>WSDL 1.1 [<cite><a class="bibref" data-link-type="biblio" href="#bib-wsdl" title="Web Service Definition Language (WSDL)">wsdl</a></cite>]</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>XML 1.0 (Second Edition)</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>XML Schema Part 1: Structures</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>XML Schema Part 2: Data types</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>De huidig toegestane TLS versies zoals beschreven in <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite></td>
<td>WS-I Basic Profile 1.2,  NCSC, NIST, ENISA</td>
</tr>
<tr>
<td>HTTP over TLS Transport Layer Security (RFC2818)</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>Internet X.509 Public Key Infrastructure Certificate and CRL Profile (RFC 3280)</td>
<td>PKI overheid 1.1</td>
</tr>
<tr>
<td>WS-Addressing 1.0 <cite><a href="https://www.w3.org/TR/ws-addr-metadata/">Web Services Addressing 1.0 - Metadata</a></cite></td>
<td>WS-I Basic Profile1.2</td>
</tr>
<tr>
<td>Web Services Addressing 1.0 – Metadata</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>SOAP 1.1 Binding for MTOM 1.0</td>
<td>WS-I Basic Profile 1.2</td>
</tr>
<tr>
<td>WS-Security 1.1</td>
<td>WS-I Basic Security Profile 1.1</td>
</tr>
<tr>
<td>WS-Security 1.0</td>
<td>WS-Security 1.1</td>
</tr>
</tbody></table></section><section id="voorschriften"><h3 id="x2-5-voorschriften"><bdi class="secno">2.5 </bdi>Voorschriften<a class="self-link" href="#voorschriften" aria-label="Permalink for Section 2.5"></a></h3><p>De inhoud van de Digikoppeling standaard vloeit voort uit bovengenoemde
standaarden, of vormt een nadere invulling daarvan (een keuze uit toegestane
mogelijkheden in die standaarden).</p><p>In de paragrafen hierna worden die onderdelen achtereenvolgens behandeld:</p><ul>
<li><p>WSDL,</p>
</li>
<li><p>WS-Addressing,</p>
</li>
<li><p>Binaire data,</p>
</li>
<li><p>Beveiliging,</p>
</li>
<li><p>Betrouwbaarheid,</p>
</li>
<li><p>Namespace.</p>
</li>
</ul><section id="service-definitie-wsdl"><h4 id="x2-5-1-service-definitie-wsdl"><bdi class="secno">2.5.1 </bdi>Service definitie WSDL<a class="self-link" href="#service-definitie-wsdl" aria-label="Permalink for Section 2.5.1"></a></h4><p>Voorschriften ten gevolge van de keuze voor BP 1.2</p><table class="dkkvs">
    <thead>
 <tr>
 <th>Nr</th>
 <th>Omschrijving</th>
 </tr>
    </thead>
    <tbody>
 <tr>
 <td>WW001</td>
 <td>Voor de SOAP berichten wordt SOAP 1.1 en “document-literal binding” gehanteerd. Hierbij wordt als
 transport binding HTTP voorgeschreven.</td>
 </tr>
 <tr>
 <td>WW002</td>
 <td>Door het opleggen van het SOAP style type “document/literal” zal de inhoud van de berichten beschreven
 worden door XML en geen afgeleide daarvan. Dit houdt in dat er niet een eigen mapping mag worden
 geïntroduceerd voor encoding types zoals bijvoorbeeld bij SOAP encoding het geval is. Kortom, de
 datatypen moeten voldoen aan de XML Schema Part 2: Datatypes</td>
 </tr>
 <tr>
 <td>WW003</td>
 <td>Bij document –literal mag het SOAP “body” element slechts 1 XML element bevatten. Hierbinnen kunnen
 eventueel wel meerdere elementen opgenomen worden.</td>
 </tr>
 <tr>
 <td>WW004</td>
 <td>Basic Profile stelt eisen aan het “PortType” van een WSDL. Hierbij mogen de “parts” van de “messages”
 alleen een “element” bevatten (geen “parts” die een “type” attribuut gebruiken). “R2204 A
 document-literal binding in a <strong>DESCRIPTION</strong> MUST refer, in each of its soapbind:body
 element(s), only to wsdl:part element(s) that have been defined using the element attribute.” Er is geen
 voorbeeld bij WS-I, maar een voorbeeld kan zijn:<div class="example" id="example-1">
        <div class="marker">
    <a class="self-link" href="#example-1">Voorbeeld<bdi> 1</bdi></a>
  </div> <pre aria-busy="false"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"TradePriceRequest"</span>&gt;</span>
&lt;complextype\&gt;
<span class="hljs-tag">&lt;<span class="hljs-name">all</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"tickerSymbol"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">element</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">all</span>&gt;</span>
&lt;/complextype\&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">element</span>&gt;</span>
…
<span class="hljs-tag">&lt;<span class="hljs-name">message</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"GetLastTradePriceInput"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">part</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"body"</span> <span class="hljs-attr">elements</span>=<span class="hljs-string">"xsd1:TradePriceRequest"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">part</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span></code></pre>
      </div></td>
 </tr>
    </tbody>
</table><p>Aanvullende voorschriften (dus specifieke Digikoppeling-invulling binnen de ruimte van een bovengenoemde standaard)</p><table class="dkkvs">
<thead>
<tr>
<th>Nr</th>
<th>Omschrijving</th>
</tr>
</thead>
<tbody><tr>
<td>WS001</td>
<td>Er kunnen meerdere operaties per webservice gedefinieerd worden.</td>
</tr>
<tr>
<td>WS002</td>
<td>De SOAPAction aanduiding in de WSDL wordt gevuld met een lege string (“”), wordt weggelaten, of heeft dezelfde vulling als de { <a href="http://www.w3.org/2007/05/addressing/metadata">http://www.w3.org/2007/05/addressing/metadata</a>}Action in de WSDL. In de HTTP Header van het bericht moet de SOAPAction een lege string met quotes zijn (“”), of een waarde hebben gelijk aan de WS-Addressing Action (wsa:Action).</td>
</tr>
<tr>
<td>WS003</td>
<td>De Digikoppeling WUS ondersteunt alleen de zogenaamde “request/response” berichtenuitwisseling (zie WSDL 1.1 specificatie paragraaf “2.4 Port Types”) [<cite><a class="bibref" data-link-type="biblio" href="#bib-wsdl" title="Web Service Definition Language (WSDL)">wsdl</a></cite>].</td>
</tr>
<tr>
<td>WS005</td>
<td>De WSDL bevat slechts één “portType” per WSDL bestand.</td>
</tr>
<tr>
<td>WS006</td>
<td>Digikoppeling ondersteunt alleen UTF-8.</td>
</tr>
<tr>
<td>WS007</td>
<td>In de header zijn geen eigen velden (header blocks) toegestaan. De header bevat alleen de in het betreffende profiel vastgestelde velden, die dus uitsluitend gedefinieerd zijn in het betreffende WS-I profiel (respectievelijk de onderliggende OASIS/W3C standaarden).</td>
</tr>
<tr>
<td>WS008</td>
<td>Het is verplicht een WS-Addressing Action referentie op te nemen in de WSDL. Het definiëren van een WS-Addressing action in WSDL kan met behulp van de Web Services Addressing 1.0 – Metadata standaard. Informatie hierover is te vinden via <a href="http://www.w3.org/TR/2007/REC-ws-addr-metadata-20070904/#explicitaction">http://www.w3.org/TR/2007/REC-ws-addr-metadata-20070904/#explicitaction</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-ws-addr-metadata" title="Web Services Addressing 1.0 - Metadata">ws-addr-metadata</a></cite>]. Zie voor mogelijke vulling van wsam:action in WSDL “4.4.4 Default Action Pattern for WSDL 1.1” van de Web Services Addressing 1.0 – Metadata standaard (<a href="http://www.w3.org/TR/2007/REC-ws-addr-metadata-20070904/">http://www.w3.org/TR/2007/REC-ws-addr-metadata-20070904/</a>).</td>
</tr>
</tbody></table></section><section id="ws-addressing"><h4 id="x2-5-2-ws-addressing"><bdi class="secno">2.5.2 </bdi>WS-Addressing<a class="self-link" href="#ws-addressing" aria-label="Permalink for Section 2.5.2"></a></h4><p>Voorschriften als gevolg van het toepassen van WS-Addressing</p><p></p><table class="dkkvs">
    <thead>
        <tr>
            <th>Nr</th>
            <th>Omschrijving</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>WA001</td>
            <td>Digikoppeling WUS gebruikt de volgende velden uit
                WS-Addressing:<br>
                <ul>
                    <li>wsa:To</li>
                    <li>wsa:Action</li>
                    <li>wsa:MessageID</li>
                    <li>wsa:RelatesTo</li>
                    <li>wsa:ReplyTo</li>
                    <li>wsa:From</li>
                </ul>
                De communicatie binnen het Digikoppeling domein is voor een deel afhankelijk van de toepassing van
                WS-Addressing velden. Aangezien er meerdere WS-Addressing specificaties zijn, die onder meer
                verschillende namespaces kunnen hebben, is er voor gekozen om alleen de specificatie van 2006/05
                [https://www.w3.org/TR/ws-addr-core/](https://www.w3.org/TR/ws-addr-core/)[<cite><a class="bibref" data-link-type="biblio" href="#bib-ws-addr-core" title="Web Services Addressing 1.0 - Core">ws-addr-core</a></cite>] verplicht te stellen in de berichten
                binnen het Digikoppeling domein. Hieronder wordt de toepassing van de verschillende velden toegelicht.
                Er is gekozen voor een zo klein mogelijke subset uit de WS-Addressing standaard om de kans op
                interoperabiliteitsissues te minimaliseren. Met het toepassen van deze standaard wordt het “achter de voordeur” routeren mogelijk.<br><br>
                <strong>wsa:To</strong> Dit wordt gebruikt om de endpoint vast te leggen waar het bericht naar toe dient te gaan. Het element wsa:to is van het type wsa:AttributedURIType - een extensie op het xs:anyUri type- en dient gevuld te worden met een ‘Adres’ element. De waarde van het adres element kan hetzij een absolute URI zijn of <code>http://www.w3.org/2005/08/addressing/anonymous</code>.
                Optioneel kan het To-adres aangevuld te worden met een OIN door het gebruik van querystring parameters (bijvoorbeeld <code>http://service-end-point?OIN=xxxxxx</code>). De waarde van de OIN in het adres is het OIN nummer van de ontvangende partij.<br><br>
                <strong>wsa:Action</strong> Deze waarde wordt gebruikt om een specifieke operatie aan te roepen. Deze waarde is terug te vinden in de WSDL van de betreffende aan te roepen webservice van de Service Provider. Dit veld is verplicht en moet in het bericht worden opgenomen.<br><br>
                <strong>wsa:MessageID</strong> De waarde hiervan kan door de service requester of provider zelf ingevuld worden zolang dit een waarde is die aan de onderliggende specificatie voldoet ([<cite><a class="bibref" data-link-type="biblio" href="#bib-ws-addr-core" title="Web Services Addressing 1.0 - Core">ws-addr-core</a></cite>]).<br><br>
                <strong>wsa:RelatesTo</strong> Dit element komt alleen voor in de SOAP header van het response bericht. Het bevat de waarde van de wsa: MessageID van het request bericht.<br><br>
                <strong>wsa: ReplyTo</strong> De verplichte specificatie van wsa:ReplyTo geldt alleen voor het request bericht. De specificatie mag zowel plaatsvinden door gebruik te maken van de default-waarde als door expliciete opname van deze SOAP-header. Voor synchrone communicatie t.b.v. bevragingen zal het replyTo veld gevuld zijn met de waarde <code>http://www.w3.org/2005/08/addressing/anonymous</code> of het element volledig weglaten. Bij weglaten van dit veld moet de ontvanger conform WS-Addressing specificatie alsnog de waarde <code>http://www.w3.org/2005/08/addressing/anonymous</code> gebruiken.<br><br>
                <strong>wsa:From</strong> Het gebruik van wsa:From is optioneel voor synchrone berichten voor
                bevragingen. De waarde van dit veld wordt gebruikt om aan te geven waar het bericht vandaan komt. De wsa:From is van het type wsa:EndPointReferenceType en dient gevuld te worden met een ‘Adres’ element (wsa:Address). De waarde van het adres element kan hetzij een absolute URI zijn of <code>http://www.w3.org/2005/08/addressing/anonymous</code>. Optioneel kan het From-adres aangevuld te worden met een OIN door het gebruik van querystring parameters (e.g. <code>http://service-end-point?OIN=xxxxxx</code>). De waarde van de OIN in het adres is het OIN nummer van de verzendende partij.<br><br>
                De elementen <strong>wsa:ReplyTo</strong> en <strong>wsa:From</strong> zijn beiden van de type
                ‘wsa:EndPointReferenceType’. Het EndPointReferenceType stelt enkel het element ‘Address’ verplicht. De overige velden van EndPointReferenceType zijn optioneel en zijn om compatibiteitsredenen niet toegestaan binnen Digikoppeling.<br><br>
                Het is toegestaan om overige WS-Addressing velden op te nemen in de berichten omdat bij sommige toolkits het genereren van deze velden niet onderdrukt kan worden. Hierbij geldt wel de beperking dat de waarde voor deze velden het routeringsmechanisme niet verstoort. Derhalve moet, indien het bericht andere velden dan hierboven bevat, de waarde <code>http://www.w3.org/2005/08/addressing/anonymous</code> of <code>http://www.w3.org/2005/08/addressing/none</code> aan deze velden toegekend worden. Overzicht verplichte WS-Addressing properties in request en response berichten (volgens
                [<cite><a class="bibref" data-link-type="biblio" href="#bib-ws-addr-metadata" title="Web Services Addressing 1.0 - Metadata">ws-addr-metadata</a></cite>])
                <br><br>
                <b>WS-Addressing request headers Field</b>
                <table class="dkkvsincell dkkvs">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Property</th>
                            <th>Mandatory</th>
                            <th>Description.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>wsa:To</td>
                            <td>[destination]</td>
                            <td>Y</td>
                            <td>Provides the address of the intended receiver of this message.</td>
                        </tr>
                        <tr>
                            <td>wsa:Action</td>
                            <td>[action]</td>
                            <td>Y</td>
                            <td>Identifies the semantics implied by this message.</td>
                        </tr>
                        <tr>
                            <td>wsa:From</td>
                            <td>[source endpoint]</td>
                            <td>Y<sup>1</sup></td>
                            <td>Provides the address of the original sender of this Message</td>
                        </tr>
                        <tr>
                            <td>wsa:ReplyTo</td>
                            <td>[reply endpoint]</td>
                            <td>Y<sup>2</sup></td>
                            <td>Intended receiver for the reply to this message.</td>
                        </tr>
                        <tr>
                            <td>wsa:FaultTo</td>
                            <td>[fault endpoint]</td>
                            <td>N</td>
                            <td>Intended receiver for faults related to this message. May be included to direct fault
                                messages to a different endpoint than [reply endpoint]</td>
                        </tr>
                        <tr>
                            <td>wsa:MessageID</td>
                            <td>[message id]</td>
                            <td>Y</td>
                            <td>Unique identifier for this message. Used in the [relationship] property of the reply
                                message. </td>
                        </tr>
                        <tr>
                            <td>wsa:RelatesTo</td>
                            <td>[relationship]</td>
                            <td>N</td>
                            <td>Indicates relationship to a prior message. Unused in this Message Exchange Pattern
                                (MEP), but could be included to facilitate longer running message exchanges.</td>
                        </tr>
                    </tbody>
                </table>
                <sup>1</sup>Voor bevragingen is source endpoint optioneel.<br>
                <sup>2</sup>Impliciet specificeren van het reply endpoint door weglaten van ReplyTo is
    ook toegestaan.
                <br><br>
                <b>WS-Addressing response headers</b>
                <table class="dkkvsincell dkkvs">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Property</th>
                            <th>Mandatory</th>
                            <th>Description.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>wsa:To</td>
                            <td>[destination]</td>
                            <td>N<sup>3</sup></td>
                            <td>Provides the address of the intended receiver of this message.</td>
                        </tr>
                        <tr>
                            <td>wsa:Action</td>
                            <td>[action]</td>
                            <td>Y</td>
                            <td>Identifies the semantics implied by this message.</td>
                        </tr>
                        <tr>
                            <td>wsa:From</td>
                            <td>[source endpoint]</td>
                            <td>N</td>
                            <td>Message origin. Unused in this MEP, but could be included to facilitate longer running message
                                exchanges.</td>
                        </tr>
                        <tr>
                            <td>wsa:ReplyTo</td>
                            <td>[reply endpoint]</td>
                            <td>N</td>
                            <td>Intended receiver for replies to this message. Unused in this MEP, but could be included to facilitate
                                longer running message exchanges.</td>
                        </tr>
                        <tr>
                            <td>wsa:FaultTo</td>
                            <td>[fault endpoint]</td>
                            <td>N</td>
                            <td>Intended receiver for faults related to this message. Unused in this MEP, but could be included to
                                facilitate longer running message exchanges.</td>
                        </tr>
                        <tr>
                            <td>wsa:MessageID</td>
                            <td>[message id]</td>
                            <td>Y<sup>4</sup></td>
                            <td>Unique identifier for this message. Unused in this MEP, but may be included to facilitate longer running
                                message exchanges.</td>
                        </tr>
                        <tr>
                            <td>wsa:RelatesTo</td>
                            <td>[relationship]</td>
                            <td>Y</td>
                            <td>Indicates that this message is a reply to the request message, using the request message [message id] value and the predefined <a href="http://www.w3.org/2005/08/addressing/reply">http://www.w3.org/2005/08/addressing/reply</a>
                                IRI.</td>
                        </tr>
                    </tbody>
                </table>
                <sup>3</sup>Sommige platformen wijken op dit punt af van de Web Service Addresing 1.0 –
Metadata standaard. Het wsa:To veld wordt bij synchrone SOAP verkeer actief uit
het antwoordbericht gefilterd. Om hier vanuit de standaard aan tegemoet te komen
mag bij het ontbreken van dit veld in het antwoordbericht door de ontvanger de
anonymous waarde (http://www.w3.org/2005/08/addressing/anonymous) worden
aangenomen.

<p><sup>4</sup> Hiermee wordt afgeweken van wat de Web Services Addressing 1.0 – Metadata
standaard voorschrijft. Volgens deze standaard is de MessageID in response
optioneel. Bovenstaande properties kunnen in een aantal gevallen ook gespecificeerd worden
door betreffende velden in de header weg te laten. Zie WS-addressing 1.0- Core, paragraaf 2.1 en paragraaf 3.2; zie ook BP 1.2 paragraaf 3.7.14.
            </p></td>
        </tr>
    </tbody>
</table></section><section id="binaire-data"><h4 id="x2-5-3-binaire-data"><bdi class="secno">2.5.3 </bdi>Binaire Data<a class="self-link" href="#binaire-data" aria-label="Permalink for Section 2.5.3"></a></h4><p>In de Digikoppeling Koppelvlakstandaard WUS worden twee mogelijkheden
ondersteund om binaire data te versturen. Dat zijn Base64Binary (Base64Binary in
payload element van het bericht) of MTOM (MIME wrappers waarbij binaire data in
een aparte Multipart/Related pakket is opgenomen). Bij het toepassen van MTOM
wordt er ook wel gesproken van een geoptimaliseerd bericht.</p><p>De meest gangbare toolkits kunnen MTOM berichten ontvangen en versturen. Het wel
of niet toepassen van MTOM kan vaak vanuit de code of middels een
configuratiebestand geregeld worden.</p><p>Bij het inrichten bepaalt de provider of een koppelvlak wel of geen
ondersteuning biedt voor MTOM. Bij een nieuwe koppeling in samenspraak, bij
toevoegen van een afnemer aan een bestaande dienst dient deze zich te
conformeren aan de bestaande inrichting (en wel of niet gebruik van MTOM).</p><table class="dkkvs">
<thead>
<tr>
<th>Nr</th>
<th>Omschrijving</th>
</tr>
</thead>
<tbody><tr>
<td>WM001</td>
<td>Toepassen MTOM wordt door webservice provider bepaald.</td>
</tr>
</tbody></table></section><section id="beveiliging"><h4 id="x2-5-4-beveiliging"><bdi class="secno">2.5.4 </bdi>Beveiliging<a class="self-link" href="#beveiliging" aria-label="Permalink for Section 2.5.4"></a></h4><p>Point-to-Point en End-to-End beveiliging wordt ondersteund. Point-to-Point
beveiliging wordt uitgevoerd op basis van TLS, End-to-End beveiliging op basis
van WS-Security.</p><section id="point-to-point-beveiliging"><h5 id="x2-5-4-1-point-to-point-beveiliging"><bdi class="secno">2.5.4.1 </bdi>Point-to-Point beveiliging<a class="self-link" href="#point-to-point-beveiliging" aria-label="Permalink for Section 2.5.4.1"></a></h5><p>Deze beveiliging zorgt ervoor dat het volledige bericht en het http-protocol is
beveiligd tijdens het transport van verzender naar ontvanger. Alle Digikoppeling
profielen verplichten point-to-point beveiliging. Hierbij gelden de volgende
voorschriften:</p><table class="dkkvs">
<thead>
<tr>
<th>Nr</th>
<th>Omschrijving</th>
</tr>
</thead>
<tbody><tr>
<td>WT001</td>
<td>Authenticatie op transportniveau gebeurt op basis TLS met tweezijdige authenticatie. De huidige toegestane protocolversies zijn beschreven in het <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>. Client and Server authenticatie is vereist gebruikmakend van HTTPS en alle in <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite> genoemde TLS versies. De TLS implementatie mag niet op een oudere TLS of SSL versie terug kunnen vallen.</td>
</tr>
<tr>
<td></td>
<td>Meer informatie in het <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite></td>
</tr>
<tr>
<td>WT002</td>
<td>De te gebruiken certificaten in de productie omgeving voldoen aan de eisen van PKIoverheid (PvE 3b) en de inhoud van de identificerende velden in het certificaat dienen te voldoen aan de afspraken als gesteld in de functionele eisen Authenticatie Digikoppeling. Met het toepassen van PKIoverheid-certificaten die Digikoppeling compliant zijn, wordt hieraan voldaan.</td>
</tr>
<tr>
<td>WT003</td>
<td>De minimaal ondersteunde TLS encryptie algoritmen en sleutellengtes worden beschreven in het <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite></td>
</tr>
<tr>
<td></td>
<td>Meer informatie in het <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite></td>
</tr>
<tr>
<td>WT004</td>
<td>De geldigheid van het certificaat wordt getoetst met betrekking tot de geldigheidsdatum en de Certificate Revocation List(CRL) die voldoet aan de eisen van PKIoverheid.</td>
</tr>
<tr>
<td>WT005</td>
<td>De betreffende CRL dient zowel voor de versturende als ontvangende partij te benaderen zijn.</td>
</tr>
<tr>
<td>WT006</td>
<td>Voor communicatie over HTTPS wordt port 443 gebruikt.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: Wanneer men afwijkt van Poort 443 dient de gebruiker van de site of de service naast https ook het afwijkende poortnummer in de URI te specificeren. Het is sterk aanbevolen voor publieke services en sites om poort 443 te handhaven en met behulp van een firewall rule of proxy pass het verkeer intern te redirecten naar een afwijkende poort. Het verbergen van een open poort door een afwijkend poortnummer te gebruiken heeft geen zin omdat port scans eenvoudig open en toegankelijke poorten ontdekken.</td>
</tr>
<tr>
<td>WT007</td>
<td>Binnen een TLS-sessie kunnen meerdere berichten verstuurd worden.</td>
</tr>
<tr>
<td>WT008</td>
<td>Voor de TLS-sessie moet een maximale duur gelden, na het verloop hiervan wordt de verbinding verbroken. Partijen zijn vrij om de maximale duur zelf te bepalen.</td>
</tr>
</tbody></table></section><section id="end-to-end-beveiliging"><h5 id="x2-5-4-2-end-to-end-beveiliging"><bdi class="secno">2.5.4.2 </bdi>End-to-End beveiliging<a class="self-link" href="#end-to-end-beveiliging" aria-label="Permalink for Section 2.5.4.2"></a></h5><p>Deze beveiliging is optioneel en wordt bovenop point-to-point beveiliging
ingezet op SOAP niveau met behulp van ondertekening en versleuteling. End-to-End
beveiliging is primair van toepassing in de scenario’s waar intermediairs
betrokken zijn gedurende de gegevensuitwisseling en in scenario’s waarbij
onweerlegbaarheid van belang is.</p><table class="dkkvs">
<thead>
<tr>
<th>Nr</th>
<th>Omschrijving</th>
</tr>
</thead>
<tbody><tr>
<td>WB001</td>
<td>Toepassen WS-Security 1.0 en WS-Security 1.1</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: Basic Security Profile 1.1 is sinds 2010 november final geworden. Hierin worden zowel de WS-Security 1.0 als de WS-Security 1.1 namespaces beide gebruikt.</td>
</tr>
<tr>
<td>WB002</td>
<td>Toepassen van Timestamp in security header met Timestamp Created is verplicht. Timestamp Expires is optioneel.<br>De tijdstamp moet een Universal Time Coordinated (UTC) tijdzone aanduiding hebben. Bij het toepassen van een timestamp gaat tijdsynchronisatie van de verschillende communicerende systemen een rol spelen. Indien dit niet mogelijk is moet hiermee met de vulling van de Created en Expires rekening worden gehouden door middel van een “timestampSkew“.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: Bij toepassen van Timestamp Expires is tijdsynchronisatie van belang. Om mogelijke problemen hiermee te voorkomen, zou er overwogen kunnen worden om een eis op te nemen dat de Expires niet in Timestamp opgenomen mag worden. Omdat het expliciet weglaten van de Expires niet in alle tooling mogelijk is, wordt hiervoor niet gekozen. Tevens kan het zijn dat door het ontbreken van tijdsynchronisatie er problemen zijn met de Timestamp Created, in de situatie waarbij de ontvanger heeft vastgesteld dat de Timestamp Created in de toekomst ligt. Hiervoor biedt tooling vaak een “timestampSkew”. Deze geeft de toegestane afwijking ten opzichte van UTC aan.</td>
</tr>
<tr>
<td>WB003</td>
<td>Indien WS-Security wordt toegepast, is ondertekenen verplicht en versleutelen optioneel (keuze profiel Digikoppeling 2W-be-S, Digikoppeling 2W-be-SE,).</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: De berichten kunnen zowel ondertekend als versleuteld worden. Gezien het doel van WS-Security, te weten het “door een intermediair heen” kunnen doorgeven van authenticatie-informatie, is ondertekenen primair van belang; daarmee is ook onweerlegbaarheid geregeld. Uiteraard kan het in een bepaalde situatie ook een eis zijn dat het bericht niet leesbaar is voor de intermediair.</td>
</tr>
<tr>
<td>WB004</td>
<td>Ondertekenen van bericht onderdelen SOAP:body, SOAP:headers (WS-Addressing headers en Timestamp) is verplicht bij toepassing van End-to-End beveiliging. Van elk van deze onderdelen dient separaat een digest te worden berekend en te worden opgenomen in het SignedInfo element. De handtekening dient te worden gegenereerd op basis van de inhoud van het SignedInfo element.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: Met het ondertekenen wordt authenticatie, integriteit en onweerlegbaarheid ondersteund. Het is van belang dat de integriteit en onweerlegbaarheid van de inhoud en header van het bericht kan worden vastgesteld, de SOAP:body, SOAP:header (WS-Addressing en het Timestamp element) zullen dus ondertekend moeten worden.</td>
</tr>
<tr>
<td>WB005</td>
<td>Bij toepassen van versleutelen geldt dit voor de volgende bericht onderdelen: SOAP:body</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: De WS-Addressing headers worden niet versleuteld, dit omdat deze anders niet leesbaar zijn voor intermediairs. De wsa:Action en de ondertekening worden dus niet versleuteld. Ook de SOAPaction kan niet afgeschermd worden. Door beveiliging op transport niveau is het risico van een niet afgeschermde wsa:Action en SOAPAction tot een minimum beperkt.</td>
</tr>
<tr>
<td>WB006</td>
<td>Berichten worden eerst ondertekend en vervolgens versleuteld.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen: Omdat er zowel wordt ondertekend als versleuteld, moet de volgorde hiervan gespecificeerd worden: -Bij verzending eerst ondertekenen en vervolgens versleutelen. -Bij ontvangst eerst ontsleutelen en daarna de ondertekening verifieren.</td>
</tr>
</tbody></table><table class="dkkvs">
    <tbody>
        <tr>
            <td>WB007</td>
            <td>Technische gegevens ten behoeve van ondertekenen
                <table class="dkkvsincell dkkvs">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Waarde</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Onderteken optie Algoritme</td>
                            <td>Exclusive XML Canonicalization
                                [http://www.w3.org/2001/10/xml-exc-c14n](http://www.w3.org/2001/10/xml-exc-c14n\#)
                        </td></tr>
                        <tr>
                            <td>Data Encryption Algorithms</td>
                            <td>zie <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>
                        </td></tr>
                        <tr>
                            <td>Key Transport Algorithms</td>
                            <td>zie <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>
                    </td></tr></tbody>
                </table>
            </td>
        </tr>
        <tr>
            <td>WB008</td>
            <td>Technische gegevens ten behoeve van versleutelen:
                <table class="dkkvsincell dkkvs">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Waarde</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Data Encryption Algorithms</td>
                            <td>zie <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>
                        </td></tr>
                        <tr>
                            <td>Key Transport Algorithms</td>
                            <td>zie <cite><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">Digikoppeling Beveiligingsstandaarden en voorschriften</a></cite>
                    </td></tr></tbody>
                </table>
            </td>
        </tr>
    </tbody>
</table><table class="dkkvs">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>WB009</td>
<td>Security token X.509 Certificate Token (PKI Overheid Digikoppeling certificaat).</td>
</tr>
<tr>
<td>WB010</td>
<td>Publieke sleutel welke gebruikt is voor het signing proces dient meegeleverd te worden met het bericht via een ‘Direct security token’ reference.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen:<br>Het certificaat wordt in het bericht meegestuurd. Hiermee kan de ontvanger door middel van het meegeleverd certificaat de handtekening controleren. Het certificaat dient uiteraard wel vertrouwd te zijn via een truststore configuratie waarin het PKIoverheid stamcertificaat alsmede de intermediair certificaten en Trusted Servicer Provider certificaten zijn opgenomen. Zie hiervoor <cite><a href="https://cert.pkioverheid.nl/">PkIoverheid certificaten</a></cite>. (een vereiste voor veel platformen om de validatie van het bericht aan te vangen).</td>
</tr>
<tr>
<td>WB011</td>
<td>Het toepassen van End-to-End beveiliging wordt op serviceniveau aangeduid. Alle operaties en dus berichten (request en response) worden ontsloten volgens één bepaald Digikoppeling profiel.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen:<br>Beveiligingseisen kunnen op het niveau van het bericht gedefinieerd worden, maar niet alle toolkits kunnen hiermee overweg. Totdat alle belangrijke toolkits dit wel kunnen, is het beter om bericht beveiliging op serviceniveau te definiëren.</td>
</tr>
<tr>
<td>WB012</td>
<td>Voor het versleutelen van het responsebericht wordt het certificaat in het requestbericht gebruikt.</td>
</tr>
<tr>
<td></td>
<td>Toelichting:<br>In eis WB010 wordt aangegeven dat het certificaat voor ondertekening in het bericht wordt opgenomen. Indien een webservice wordt ontsloten volgens het Digikoppeling 2W-be-SE profiel moet deze op basis van het requestbericht kunnen bepalen welk certificaat gebruikt moet worden om de payload van de response te versleutelen. Dit kan door het certificaat in het requestbericht te gebruiken voor versleuteling van de response. Ook de requester dient hier dus rekening mee te houden bij ontsleutelen van het responsebericht.<br>Om het request bericht initieel te versleutelen dient de publieke sleutel van de ontvangende partij al in de truststore geregistreerd te zijn.</td>
</tr>
<tr>
<td>WB013</td>
<td>Indien WS-Security wordt toegepast, is het controleren van de signature door de ontvangende partij verplicht.</td>
</tr>
<tr>
<td></td>
<td>Overwegingen:<br>Het ondertekenen van berichten is alleen zinvol als de ontvanger van het bericht ook daadwerkelijk de signature valideerd. Indien de validatie mislukt, dient het bericht afgewezen te worden en een foutmelding als antwoord te worden verstuurd.<br>Ook indien de ondertekening van de respons niet valide is mogen de gegevens niet verwerkt worden. De ontvanger kan wedermaal een requestbericht versturen, maar de kans is groot dat out-of-band communicatie noodzakelijk is om er voor te zorgen dat de dienstaanbieder een valide respons stuurt.</td>
</tr>
<tr>
<td>WB014</td>
<td>Indien WS-Security wordt toegepast dient het responsebericht de signature van het requestbericht als onderdeel van het SignatureConfirmation element op te nemen (WS Security 1.1.).</td>
</tr>
<tr>
<td></td>
<td>Overwegingen:<br>Door het herhalen van de ondertekening van het requestbericht kan de ontvanger van het responsebericht valideren dat het oorspronkelijke requestbericht in onaangetaste staat is ontvangen en verwerkt.<br>Een contract wordt voor een Digikoppeling WUS Koppelvlak gedefinieerd door een WSDL. De WSDL 1.1 specificatie op zich biedt geen mogelijkheden om het gebruik van WS-Security aan te geven.</td>
</tr>
</tbody></table></section></section><section id="naamgeving-namespaces"><h4 id="x2-5-5-naamgeving-namespaces"><bdi class="secno">2.5.5 </bdi>Naamgeving, namespaces<a class="self-link" href="#naamgeving-namespaces" aria-label="Permalink for Section 2.5.5"></a></h4><p>Er worden geen aanvullende eisen gesteld aan de namespaces. In de header mogen
alleen velden voorkomen conform OASIS/W3C standaarden (gebaseerd op de daar
gedefinieerde namespaces) , of service-specifieke namen, gedefinieerd door de
provider met een namespace gedefinieerd door de provider. Ook aan de naamgeving
van services, operations etc. worden vanuit Digikoppeling geen eisen gesteld. De
prefix “Digikoppeling” is gereserveerd voor mogelijk toekomstig gebruik.</p></section></section><section id="foutafhandeling"><h3 id="x2-6-foutafhandeling"><bdi class="secno">2.6 </bdi>Foutafhandeling<a class="self-link" href="#foutafhandeling" aria-label="Permalink for Section 2.6"></a></h3><p>Er worden momenteel nog geen eisen gesteld aan de foutafhandeling, anders dan in
de onderliggende specificaties vermeld worden, zoals WS-I Basic Profile 1.2. In
het document ” Digikoppeling Best Practices WUS” is een aantal adviezen
opgenomen.</p><p>Aanvullende standaarden die gebruikt worden in combinatie met Digikoppeling
kunnen overigens wel eisen stellen aan de fouthandeling.</p></section></section>
<section data-format="markdown" id="digikoppeling-profielen-wus"><h2 id="x3-digikoppeling-profielen-wus"><bdi class="secno">3. </bdi>Digikoppeling profielen WUS<a class="self-link" href="#digikoppeling-profielen-wus" aria-label="Permalink for Section 3."></a></h2><p>Op Digikoppeling wordt gewerkt met zogenaamde “profielen”. Een profiel is een
gedefinieerde bundeling van functionaliteit en daarmee van voorschriften. In de
huidige Digikoppeling versie zijn drie WUS-profielen aanwezig:</p><ul>
<li><p>Digikoppeling 2W-be,</p>
</li>
<li><p>Digikoppeling 2W-be-S en</p>
</li>
<li><p>Digikoppeling 2W-be-SE.</p>
</li>
</ul><p>Voor de drie profielen geldt dat deze zowel geoptimaliseerd (volgens de MTOM
standaard) als niet geoptimaliseerd verstuurd kunnen worden. Hierom zijn voor
elk profiel voorbeeldberichten beschikbaar in zowel de geoptimaliseerde (MTOM)
als niet geoptimaliseerde vorm. Alle voorbeeldberichten zijn gebundeld in een
set <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite> en beschikbaar op de <cite><a href="https://logius.nl/digikoppeling">Logius Digikoppeling</a></cite>.</p><p>Ten aanzien van beveiliging maken alle profielen gebruik van tweezijdig TLS, zie
hoofdstuk 2 paragraaf “Point-to-Point beveiliging”.</p><p><figure id="fig-schematische-weergave-digikoppeling-wus-profielen"><img src="media/wus_profielen_digikoppeling.png" alt="Digikoppeling WUS profielen bevinden zich in de logistieke laag dat via een SOAP processor verbonden is met de applicatielaag." title="Schematische weergave Digikoppeling WUS profielen"><figcaption>Figuur <bdi class="figno">2</bdi> <span class="fig-title">Schematische weergave Digikoppeling WUS profielen</span></figcaption></figure></p><p>In het bovenstaande figuur wordt schematisch weergegeven welke WUS profielen
Digikoppeling biedt en wat de algemene verschillen zijn. Alle profielen worden
in de volgende paragrafen in meer detail beschreven. In set <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>
zijn voorbeeld berichten opgenomen voor de drie profielen. Deze bieden een
duidelijk inzicht hoe de berichten uiteindelijk eruit komen te zien.</p><section id="wus-profiel-digikoppeling-2w-be"><h3 id="x3-1-wus-profiel-digikoppeling-2w-be"><bdi class="secno">3.1 </bdi>WUS Profiel Digikoppeling 2W-be<a class="self-link" href="#wus-profiel-digikoppeling-2w-be" aria-label="Permalink for Section 3.1"></a></h3><dl>
<dt>Beveiliging</dt>
<dd>
Dit profiel maakt voor de beveiliging alleen gebruik van tweezijdig TLS.
</dd>
<dt>Headerblocks</dt>
<dd>
Alleen de verplichte WS-Addressing headers zijn hier van toepassing (zie
soapenv:Header in <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>).
</dd>
<dt>MTOM</dt>
<dd>
De geoptimaliseerde (MTOM) voorbeeldberichten worden weergegeven in <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>.
</dd>
</dl></section><section id="wus-profiel-digikoppeling-2w-be-s"><h3 id="x3-2-wus-profiel-digikoppeling-2w-be-s"><bdi class="secno">3.2 </bdi>WUS Profiel Digikoppeling 2W-be-S<a class="self-link" href="#wus-profiel-digikoppeling-2w-be-s" aria-label="Permalink for Section 3.2"></a></h3><dl>
<dt>Beveiliging</dt>
<dd>
Dit profiel maakt voor de beveiliging gebruik van tweezijdig TLS en tevens
worden de berichtonderdelen ondertekend zoals vermeld in hoofdstuk 2, paragraaf
End-to-End beveiliging.
</dd>
<dt>Headerblocks</dt>
<dd>
In dit profiel zijn de WS-Addressing en WS-Security 1.0 ondertekening
(wsse:Security) headers van toepassing (zie <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>).
</dd>
<dt>MTOM</dt>
<dd>
De geoptimaliseerde (MTOM) voorbeeldberichten voor profiel Digikoppeling 2W-be-S
worden weergegeven in <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>.
</dd>
</dl></section><section id="wus-profiel-digikoppeling-2w-be-se"><h3 id="x3-3-wus-profiel-digikoppeling-2w-be-se"><bdi class="secno">3.3 </bdi>WUS Profiel Digikoppeling 2W-be-SE<a class="self-link" href="#wus-profiel-digikoppeling-2w-be-se" aria-label="Permalink for Section 3.3"></a></h3><dl>
<dt>Beveiliging</dt>
<dd>
Dit profiel maakt voor de beveiliging gebruik van tweezijdig TLS en tevens
worden de berichtonderdelen ondertekend en versleuteld zoals vermeld in
hoofdstuk 2, paragraaf End-to-End beveiliging.
</dd>
<dt>Headerblocks</dt>
<dd>
In dit profiel zijn de WS-Addressing en WS-Security 1.0 ondertekening
(wsse:Security) headers van toepassing. Ook wordt hierbij de payload van het
bericht versleuteld (xenc:EncryptedData) (zie <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>).
</dd>
<dt>MTOM</dt>
<dd>
De geoptimaliseerde (MTOM) voorbeeldberichten voor profiel Digikoppeling
2W-be-SE worden weergegeven in <cite><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">Digikoppeling WUS voorbeelden (zip)</a></cite>.
</dd>
</dl></section></section>
  
    
    <section id="conformance"><h2 id="x4-conformiteit"><bdi class="secno">4. </bdi>Conformiteit<a class="self-link" href="#conformance" aria-label="Permalink for Section 4."></a></h2><p>Naast onderdelen die als niet normatief gemarkeerd zijn, zijn ook alle diagrammen, voorbeelden, en noten in dit document niet normatief. Verder is alles in dit document normatief.</p>
      
    </section>
  
    <section id="tof">
      
    <h2 id="x5-lijst-met-figuren"><bdi class="secno">5. </bdi>Lijst met figuren<a class="self-link" href="#tof" aria-label="Permalink for Section 5."></a></h2><ul class="tof">
        <li class="tofline">
    <a class="tocxref" href="#fig-opbouw-documentatie-digikoppeling">Figuur <bdi class="figno">1</bdi> <span class="fig-title">Opbouw documentatie Digikoppeling</span></a>
  </li><li class="tofline">
    <a class="tocxref" href="#fig-schematische-weergave-digikoppeling-wus-profielen">Figuur <bdi class="figno">2</bdi> <span class="fig-title">Schematische weergave Digikoppeling WUS profielen</span></a>
  </li>
      </ul></section>
  
    
      
    
  
    
      
    
  
      
    


<section id="references" class="appendix"><h2 id="a-referenties"><bdi class="secno">A. </bdi>Referenties<a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></h2><section id="normatieve-referenties">
    <h3 id="a-1-normatieve-referenties"><bdi class="secno">A.1 </bdi>Normatieve referenties<a class="self-link" href="#normatieve-referenties" aria-label="Permalink for Appendix A.1"></a></h3>
    <dl class="bibliography"><dt id="bib-beveiligingsdocument">[Beveiligingsdocument]</dt><dd><a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf"><cite>Digikoppeling Beveiligingsstandaarden en voorschriften</cite></a>.  Logius. 2020. URL: <a href="https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf">https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf</a></dd><dt id="bib-certificaten">[Certificaten]</dt><dd><a href="https://cert.pkioverheid.nl/"><cite>PkIoverheid certificaten</cite></a>.  Logius. URL: <a href="https://cert.pkioverheid.nl/">https://cert.pkioverheid.nl/</a></dd><dt id="bib-ws-addr-core">[ws-addr-core]</dt><dd><a href="https://www.w3.org/TR/ws-addr-core/"><cite>Web Services Addressing 1.0 - Core</cite></a>. Martin Gudgin; Marc Hadley; Tony Rogers.  W3C. 9 May 2006. W3C Recommendation. URL: <a href="https://www.w3.org/TR/ws-addr-core/">https://www.w3.org/TR/ws-addr-core/</a></dd><dt id="bib-ws-addr-metadata">[ws-addr-metadata]</dt><dd><a href="https://www.w3.org/TR/ws-addr-metadata/"><cite>Web Services Addressing 1.0 - Metadata</cite></a>. Martin Gudgin; Marc Hadley; Tony Rogers; Ümit Yalçinalp et al.  W3C. 4 September 2007. W3C Recommendation. URL: <a href="https://www.w3.org/TR/ws-addr-metadata/">https://www.w3.org/TR/ws-addr-metadata/</a></dd><dt id="bib-wsdl">[wsdl]</dt><dd><a href="https://www.w3.org/TR/wsdl"><cite>Web Service Definition Language (WSDL)</cite></a>.  W3C. 15 March 2001. W3C Working Group Note. URL: <a href="https://www.w3.org/TR/wsdl">https://www.w3.org/TR/wsdl</a></dd></dl>
  </section><section id="informatieve-referenties">
    <h3 id="a-2-informatieve-referenties"><bdi class="secno">A.2 </bdi>Informatieve referenties<a class="self-link" href="#informatieve-referenties" aria-label="Permalink for Appendix A.2"></a></h3>
    <dl class="bibliography"><dt id="bib-compliance">[Compliance]</dt><dd><a href="https://portaal.digikoppeling.nl"><cite>Digikoppeling Compliance Voorziening</cite></a>.  Logius. URL: <a href="https://portaal.digikoppeling.nl">https://portaal.digikoppeling.nl</a></dd><dt id="bib-logius">[Logius]</dt><dd><a href="https://logius.nl/digikoppeling"><cite>Logius Digikoppeling</cite></a>.  Logius. URL: <a href="https://logius.nl/digikoppeling">https://logius.nl/digikoppeling</a></dd><dt id="bib-voorbeelden">[Voorbeelden]</dt><dd><a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip"><cite>Digikoppeling WUS voorbeelden (zip)</cite></a>.  Logius. URL: <a href="https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip">https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Overig/Digikoppeling-Koppelvlakstandaard-WUS-Voorbeeldberichten.zip</a></dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>